(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{732:function(e,t,i){"use strict";var n=i(0),o=i.n(n),a=i(1),r=i.n(a),s=i(763),l=i(727),c=i(691),u=i(736),p=i(733),d=i(723),f=i(734),h=i(719),g=i(718);function m(){return(m=Object.assign||function(e){for(var t,i=1;i<arguments.length;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var y=c.a.getScale;var b={formData:r.a.object.isRequired,mapboxApiKey:r.a.string.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,getLayer:r.a.func.isRequired,getPoints:r.a.func.isRequired,payload:r.a.object.isRequired,onAddFilter:r.a.func,setTooltip:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired},_=function(e){function t(t){var i;return(i=e.call(this,t)||this).state=i.getStateFromProps(t),i.getLayers=i.getLayers.bind(v(i)),i.onValuesChange=i.onValuesChange.bind(v(i)),i.toggleCategory=i.toggleCategory.bind(v(i)),i.showSingleCategory=i.showSingleCategory.bind(v(i)),i}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var i=t.prototype;return i.UNSAFE_componentWillReceiveProps=function(e){e.payload.form_data!==this.state.formData&&this.setState(m({},this.getStateFromProps(e)))},i.onValuesChange=function(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})},i.getStateFromProps=function(e,t){var i=e.payload.data.features||[],n=i.map((function(e){return e.__timestamp})),o=function(e,t){var i=e.color_picker||{r:0,g:0,b:0,a:1},n=[i.r,i.g,i.b,255*i.a],o=y(e.color_scheme),a={};return t.forEach((function(t){var r;null==t.cat_color||a.hasOwnProperty(t.cat_color)||(r=e.dimension?Object(d.hexToRGB)(o(t.cat_color),255*i.a):n,a[t.cat_color]={color:r,enabled:!0})})),a}(e.formData,i);if(t&&e.payload.form_data===t.formData)return m({},t,{categories:o});var a=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",r=Object(f.a)(n,a);return{start:r.start,end:r.end,getStep:r.getStep,values:r.values,disabled:r.disabled,viewport:e.formData.autozoom?Object(g.b)(e.viewport,e.getPoints(i)):e.viewport,selected:[],lastClick:0,formData:e.payload.form_data,categories:o}},i.getLayers=function(e){var t=this.props,i=t.getLayer,n=t.payload,o=t.formData,a=t.onAddFilter,r=t.setTooltip,s=n.data.features?[].concat(n.data.features):[];(s=this.addColor(s,o),o.js_data_mutator)&&(s=Object(h.a)(o.js_data_mutator)(s));s=e[0]===e[1]||e[1]===this.end?s.filter((function(t){return t.__timestamp>=e[0]&&t.__timestamp<=e[1]})):s.filter((function(t){return t.__timestamp>=e[0]&&t.__timestamp<e[1]}));var l=this.state.categories;return o.dimension&&(s=s.filter((function(e){return l[e.cat_color]&&l[e.cat_color].enabled}))),[i(o,m({},n,{data:m({},n.data,{features:s})}),a,r)]},i.addColor=function(e,t){var i=t.color_picker||{r:0,g:0,b:0,a:1},n=y(t.color_scheme);return e.map((function(e){return t.dimension?m({},e,{color:Object(d.hexToRGB)(n(e.cat_color),255*i.a)}):e}))},i.toggleCategory=function(e){var t,i=this.state.categories[e],n=m({},this.state.categories,((t={})[e]=m({},i,{enabled:!i.enabled}),t));Object.values(n).every((function(e){return!e.enabled}))&&Object.values(n).forEach((function(e){e.enabled=!0})),this.setState({categories:n})},i.showSingleCategory=function(e){var t=m({},this.state.categories);Object.values(t).forEach((function(e){e.enabled=!1})),t[e].enabled=!0,this.setState({categories:t})},i.render=function(){return o.a.createElement("div",{style:{position:"relative"}},o.a.createElement(u.a,{getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,onValuesChange:this.onValuesChange,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},o.a.createElement(p.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))},t}(o.a.PureComponent);function C(){return(C=Object.assign||function(e){for(var t,i=1;i<arguments.length;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}_.propTypes=b,i.d(t,"b",(function(){return P})),i.d(t,"a",(function(){return S}));var x={formData:r.a.object.isRequired,payload:r.a.object.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,onAddFilter:r.a.func,setTooltip:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired},w={onAddFilter:function(){},setTooltip:function(){}};function P(e,t){var i=function(i){function n(e){var n=i.call(this,e)||this,o=e.viewport,a=e.formData.autozoom?Object(g.b)(o,t(e.payload.data.features)):o;return n.state={viewport:a,layer:n.computeLayer(e)},n.onViewportChange=n.onViewportChange.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(n,i);var a=n.prototype;return a.UNSAFE_componentWillReceiveProps=function(e){var t=C({},e.formData,{viewport:null}),i=C({},this.props.formData,{viewport:null});Object(s.isEqual)(t,i)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})},a.onViewportChange=function(e){this.setState({viewport:e})},a.computeLayer=function(t){var i=t.formData,n=t.payload,o=t.onAddFilter,a=t.setTooltip;return e(i,n,o,a)},a.render=function(){var e=this.props,t=e.formData,i=e.payload,n=e.setControlValue,a=e.height,r=e.width,s=this.state,c=s.layer,u=s.viewport;return o.a.createElement(l.a,{mapboxApiAccessToken:i.data.mapboxApiKey,viewport:u,layers:[c],mapStyle:t.mapbox_style,setControlValue:n,onViewportChange:this.onViewportChange,width:r,height:a})},n}(o.a.PureComponent);return i.propTypes=x,i.defaultProps=w,i}function S(e,t){function i(i){var n=i.formData,a=i.payload,r=i.setControlValue,s=i.onAddFilter,l=i.setTooltip,c=i.viewport,u=i.width,p=i.height;return o.a.createElement(_,{formData:n,mapboxApiKey:a.data.mapboxApiKey,setControlValue:r,viewport:c,getLayer:e,payload:a,onAddFilter:s,setTooltip:l,getPoints:t,width:u,height:p})}return i.propTypes=x,i.defaultProps=w,i}},733:function(e,t,i){"use strict";i.d(t,"a",(function(){return c}));var n=i(0),o=i.n(n),a=i(1),r=i.n(a),s=i(1045);i(737);var l={categories:r.a.object,toggleCategory:r.a.func,showSingleCategory:r.a.func,format:r.a.string,position:r.a.oneOf([null,"tl","tr","bl","br"])},c=function(e){function t(){return e.apply(this,arguments)||this}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var i=t.prototype;return i.format=function(e){if(!this.props.format)return e;var t=parseFloat(e);return Object(s.a)(this.props.format,t)},i.formatCategoryLabel=function(e){if(!this.props.format)return e;if(e.includes(" - ")){var t=e.split(" - ");return this.format(t[0])+" - "+this.format(t[1])}return this.format(e)},i.render=function(){var e,t=this;if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;var i=Object.entries(this.props.categories).map((function(e){var i=e[0],n=e[1],a={color:"rgba("+n.color.join(", ")+")"},r=n.enabled?"◼":"◻";return o.a.createElement("li",{key:i},o.a.createElement("a",{href:"#",onClick:function(){return t.props.toggleCategory(i)},onDoubleClick:function(){return t.props.showSingleCategory(i)}},o.a.createElement("span",{style:a},r)," ",t.formatCategoryLabel(i)))})),n="t"===this.props.position.charAt(0)?"top":"bottom",a="r"===this.props.position.charAt(1)?"right":"left",r=((e={position:"absolute"})[n]="0px",e[a]="10px",e);return o.a.createElement("div",{className:"legend",style:r},o.a.createElement("ul",{className:"categories"},i))},t}(o.a.PureComponent);c.propTypes=l,c.defaultProps={categories:{},toggleCategory:function(){},showSingleCategory:function(){},format:null,position:"tr"}},737:function(e,t,i){var n=i(738);"string"==typeof n&&(n=[[e.i,n,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};i(341)(n,o);n.locals&&(e.exports=n.locals)},738:function(e,t,i){(e.exports=i(340)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\ndiv.legend {\n    font-size: 90%;\n    position: absolute;\n    background: #fff;\n    box-shadow: 0 0 4px rgba(0, 0, 0, 0.15);\n    margin: 24px;\n    padding: 12px 20px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n}\n\nul.categories {\n    list-style: none;\n    padding-left: 0;\n    margin: 0;\n}\n\nul.categories li a {\n    color: rgb(51, 51, 51);\n    text-decoration: none;\n}\n\nul.categories li a span {\n    margin-right: 10px;\n}\n',""])},823:function(e,t,i){"use strict";var n=i(709),o=i(710),a=i(711),r=i(211),s=i(720),l=i(712),c=i(808),u=i(784),p=i(1074),d=i(919),f=i(846);i.d(t,"a",(function(){return v}));var h=p.a.fp64LowPart,g=[0,0,0,255],m={radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,fp64:!1,filled:!0,getPosition:{type:"accessor",value:function(e){return e.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:g},getLineColor:{type:"accessor",value:g},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},v=function(e){function t(){return Object(n.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(e){return{vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n  float outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, offset);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity) / 255.;\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  } \n  if (distToCenter > innerUnitRadius) {\n    gl_FragColor = vLineColor;\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:4,transition:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(e){var i=e.props,n=e.oldProps,o=e.changeFlags;if(Object(s.a)(Object(r.a)(t.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:o}),i.fp64!==n.fp64){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,i=this.context.viewport,n=this.props,o=n.radiusScale,a=n.radiusMinPixels,r=n.radiusMaxPixels,s=n.stroked,l=n.filled,c=n.lineWidthUnits,u=n.lineWidthScale,p=n.lineWidthMinPixels,d=n.lineWidthMaxPixels,f="pixels"===c?i.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},t,{stroked:s?1:0,filled:l,radiusScale:o,radiusMinPixels:a,radiusMaxPixels:r,lineWidthScale:u*f,lineWidthMinPixels:p,lineWidthMaxPixels:d})).draw()}},{key:"_getModel",value:function(e){return new d.a(e,Object.assign(this.getShaders(),{id:this.props.id,geometry:new f.a({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(e,t){var i=t.startRow,n=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var a=this.props,r=a.data,s=a.getPosition,l=e.value,u=i*e.size,p=Object(c.a)(r,i,n),d=p.iterable,f=p.objectInfo,g=!0,m=!1,v=void 0;try{for(var y,b=d[Symbol.iterator]();!(g=(y=b.next()).done);g=!0){var _=y.value;f.index++;var C=s(_,f);l[u++]=h(C[0]),l[u++]=h(C[1])}}catch(e){m=!0,v=e}finally{try{g||null==b.return||b.return()}finally{if(m)throw v}}}else e.value=new Float32Array(2)}}]),t}(u.a);v.layerName="ScatterplotLayer",v.defaultProps=m},925:function(e,t,i){"use strict";i.r(t);var n=i(823),o=i(0),a=i.n(o),r=i(690),s=i(718),l=i(732),c=i(724);var u=1609.34;function p(){return(p=Object.assign||function(e){for(var t,i=1;i<arguments.length;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}function d(e,t,i,o){var l=e,d=t.data.features.map((function(e){var t=function(e,t){return"square_m"===e?Math.sqrt(t/Math.PI):"radius_m"===e?t:"radius_km"===e?1e3*t:"radius_miles"===e?t*u:"square_km"===e?1e3*Math.sqrt(t/Math.PI):"square_miles"===e?Math.sqrt(t/Math.PI)*u:null}(l.point_unit,e.radius)||10;if(l.multiplier&&(t*=l.multiplier),e.color)return p({},e,{radius:t});var i=l.color_picker||{r:0,g:0,b:0,a:1};return p({},e,{radius:t,color:[i.r,i.g,i.b,255*i.a]})}));return new n.a(p({id:"scatter-layer-"+l.slice_id,data:d,fp64:!0,getFillColor:function(e){return e.color},getRadius:function(e){return e.radius},radiusMinPixels:l.min_radius||null,radiusMaxPixels:l.max_radius||null,stroked:!1},Object(s.a)(l,o,function(e){return function(t){return a.a.createElement("div",{className:"deckgl-tooltip"},a.a.createElement(c.a,{label:Object(r.b)("Longitude and Latitude")+": ",value:t.object.position[0]+", "+t.object.position[1]}),t.object.cat_color&&a.a.createElement(c.a,{label:Object(r.b)("Category")+": ",value:""+t.object.cat_color}),t.object.metric&&a.a.createElement(c.a,{label:e.point_radius_fixed.value.label+": ",value:""+t.object.metric}))}}(l))))}i.d(t,"getLayer",(function(){return d}));t.default=Object(l.a)(d,(function(e){return e.map((function(e){return e.position}))}))}}]);