(window.webpackJsonp=window.webpackJsonp||[]).push([[9,3],{745:function(e,t,n){"use strict";n.d(t,"b",(function(){return g})),n.d(t,"a",(function(){return p})),n.d(t,"c",(function(){return f}));var i=n(992),a=n(743),o=n(747);function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}const s=90,l=-90,c=180,u=-180;function d(e){const t=a.extent(e,e=>e[1]),n=a.extent(e,e=>e[0]),i=t[0]===t[1]?function(e){return[e[0]-.25<l?l:e[0]-.25,e[1]+.25>s?s:e[1]+.25]}(t):t,o=n[0]===n[1]?function(e){return[e[0]-.25<u?u:e[0]-.25,e[1]+.25>c?c:e[1]+.25]}(n):n;return[[o[0],i[0]],[o[1],i[1]]]}function g(e,t,n){void 0===n&&(n=10);try{const a=d(t);return r({},e,{},Object(i.a)({bounds:a,height:e.height,padding:n,width:e.width}))}catch(t){return console.error("Could not auto zoom",t),e}}function p(e,t,n,i){const a=e;let r,s,l=n;return a.js_tooltip&&(l=Object(o.a)(a.js_tooltip)),l&&(r=e=>{e.picked?t({content:l(e),x:e.x,y:e.y}):t(null)}),a.js_onclick_href?s=e=>{const t=Object(o.a)(a.js_onclick_href)(e);window.open(t)}:a.table_filter&&void 0!==i&&(s=e=>i(e.object[a.line_column])),{onClick:s,onHover:r,pickable:Boolean(r)}}const h={p1:.01,p5:.05,p95:.95,p99:.99};function f(e,t){if(void 0===e&&(e="sum"),void 0===t&&(t=null),"count"===e)return e=>e.length;let n;return n=e in h?(n,i)=>{let o;return o=t?n.sort((e,n)=>a.ascending(t(e),t(n))):n.sort(a.ascending),a.quantile(o,h[e],i)}:a[e],t?e=>n(e.map(e=>t(e))):e=>n(e)}},747:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var i=n(799),a=n.n(i),o=n(800),r=n.n(o),s=n(743),l=n(752);function c(){return(c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}const u={console:console,_:r(),colors:l,d3array:s};function d(e,t,n){const i={},o="SAFE_EVAL_"+Math.floor(1e6*Math.random());i[o]={};const r=o+"="+e,s=c({},u,{},t);Object.keys(s).forEach(e=>{i[e]=s[e]});try{return a.a.runInNewContext(r,i,n),i[o]}catch(e){return()=>e}}},752:function(e,t,n){"use strict";n.r(t),n.d(t,"hexToRGB",(function(){return a}));var i=n(734);function a(e,t){if(void 0===t&&(t=255),!e)return[0,0,0,t];const{r:n,g:a,b:o}=Object(i.b)(e);return[n,a,o,t]}},753:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(0),a=n.n(i),o=n(2),r=n.n(o);const s={label:r.a.string.isRequired,value:r.a.string.isRequired};class l extends a.a.PureComponent{render(){const{label:e,value:t}=this.props;return a.a.createElement("div",null,e,a.a.createElement("strong",null,t))}}l.propTypes=s},756:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(0),a=n.n(i),o=n(2),r=n.n(o),s=n(812),l=n(1119);n(803),n(771);const c={viewport:r.a.object.isRequired,layers:r.a.array.isRequired,setControlValue:r.a.func,mapStyle:r.a.string,mapboxApiAccessToken:r.a.string.isRequired,children:r.a.node,bottomMargin:r.a.number,width:r.a.number.isRequired,height:r.a.number.isRequired};class u extends a.a.Component{constructor(e){super(e),this.tick=this.tick.bind(this),this.onViewStateChange=this.onViewStateChange.bind(this),this.state={timer:setInterval(this.tick,250),viewState:e.viewport}}componentWillUnmount(){clearInterval(this.state.timer)}onViewStateChange(e){let{viewState:t}=e;this.setState({viewState:t,lastUpdate:Date.now()})}tick(){const{lastUpdate:e}=this.state;if(e&&Date.now()-e>250){const e=this.props.setControlValue;e&&e("viewport",this.state.viewState),this.setState({lastUpdate:null})}}layers(){return this.props.layers.some(e=>"function"==typeof e)?this.props.layers.map(e=>"function"==typeof e?e():e):this.props.layers}render(){const{children:e,bottomMargin:t,height:n,width:i}=this.props,{viewState:o}=this.state,r=n-t,c=this.layers();return a.a.createElement("div",{style:{position:"relative",width:i,height:r}},a.a.createElement(l.a,{initWebGLParameters:!0,controller:!0,width:i,height:r,layers:c,viewState:o,onViewStateChange:this.onViewStateChange},a.a.createElement(s.a,{mapStyle:this.props.mapStyle,mapboxApiAccessToken:this.props.mapboxApiAccessToken})),e)}}u.propTypes=c,u.defaultProps={mapStyle:"light",setControlValue:()=>{},children:null,bottomMargin:0}},761:function(e,t,n){"use strict";var i=n(0),a=n.n(i),o=n(2),r=n.n(o),s=n(790),l=n(756),c=n(712),u=n(765),d=n(762),g=n(752),p=n(763),h=n(747),f=n(745);function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}const{getScale:m}=c.a;const y={formData:r.a.object.isRequired,mapboxApiKey:r.a.string.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,getLayer:r.a.func.isRequired,getPoints:r.a.func.isRequired,payload:r.a.object.isRequired,onAddFilter:r.a.func,setTooltip:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired};class b extends a.a.PureComponent{constructor(e){super(e),this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState(v({},this.getStateFromProps(e)))}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const n=e.payload.data.features||[],i=n.map(e=>e.__timestamp),a=function(e,t){const n=e.color_picker||{r:0,g:0,b:0,a:1},i=[n.r,n.g,n.b,255*n.a],a=m(e.color_scheme),o={};return t.forEach(t=>{if(null!=t.cat_color&&!o.hasOwnProperty(t.cat_color)){let r;r=e.dimension?Object(g.hexToRGB)(a(t.cat_color),255*n.a):i,o[t.cat_color]={color:r,enabled:!0}}}),o}(e.formData,n);if(t&&e.payload.form_data===t.formData)return v({},t,{categories:a});const o=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:r,end:s,getStep:l,values:c,disabled:u}=Object(p.a)(i,o);return{start:r,end:s,getStep:l,values:c,disabled:u,viewport:e.formData.autozoom?Object(f.b)(e.viewport,e.getPoints(n)):e.viewport,selected:[],lastClick:0,formData:e.payload.form_data,categories:a}}getLayers(e){const{getLayer:t,payload:n,formData:i,onAddFilter:a,setTooltip:o}=this.props;let r=n.data.features?[...n.data.features]:[];if(r=this.addColor(r,i),i.js_data_mutator){r=Object(h.a)(i.js_data_mutator)(r)}r=e[0]===e[1]||e[1]===this.end?r.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):r.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]);const s=this.state.categories;return i.dimension&&(r=r.filter(e=>s[e.cat_color]&&s[e.cat_color].enabled)),[t(i,v({},n,{data:v({},n.data,{features:r})}),a,o)]}addColor(e,t){const n=t.color_picker||{r:0,g:0,b:0,a:1},i=m(t.color_scheme);return e.map(e=>{let a;return t.dimension?(a=Object(g.hexToRGB)(i(e.cat_color),255*n.a),v({},e,{color:a})):e})}toggleCategory(e){const t=this.state.categories[e],n=v({},this.state.categories,{[e]:v({},t,{enabled:!t.enabled})});Object.values(n).every(e=>!e.enabled)&&Object.values(n).forEach(e=>{e.enabled=!0}),this.setState({categories:n})}showSingleCategory(e){const t=v({},this.state.categories);Object.values(t).forEach(e=>{e.enabled=!1}),t[e].enabled=!0,this.setState({categories:t})}render(){return a.a.createElement("div",{style:{position:"relative"}},a.a.createElement(u.a,{getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},a.a.createElement(d.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))}}function S(){return(S=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}b.propTypes=y,n.d(t,"b",(function(){return w})),n.d(t,"a",(function(){return O}));const x={formData:r.a.object.isRequired,payload:r.a.object.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,onAddFilter:r.a.func,setTooltip:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired},C={onAddFilter(){},setTooltip(){}};function w(e,t){class n extends a.a.PureComponent{constructor(e){super(e);const n=e.viewport,i=e.formData.autozoom?Object(f.b)(n,t(e.payload.data.features)):n;this.state={viewport:i,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t=S({},e.formData,{viewport:null}),n=S({},this.props.formData,{viewport:null});Object(s.isEqual)(t,n)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(t){const{formData:n,payload:i,onAddFilter:a,setTooltip:o}=t;return e(n,i,a,o)}render(){const{formData:e,payload:t,setControlValue:n,height:i,width:o}=this.props,{layer:r,viewport:s}=this.state;return a.a.createElement(l.a,{mapboxApiAccessToken:t.data.mapboxApiKey,viewport:s,layers:[r],mapStyle:e.mapbox_style,setControlValue:n,width:o,height:i,onViewportChange:this.onViewportChange})}}return n.propTypes=x,n.defaultProps=C,n}function O(e,t){function n(n){const{formData:i,payload:o,setControlValue:r,setTooltip:s,viewport:l,width:c,height:u}=n;return a.a.createElement(b,{formData:i,mapboxApiKey:o.data.mapboxApiKey,setControlValue:r,viewport:l,getLayer:e,payload:o,setTooltip:s,getPoints:t,width:c,height:u})}return n.propTypes=x,n.defaultProps=C,n}},762:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(0),a=n.n(i),o=n(2),r=n.n(o),s=n(1090);n(766);const l={categories:r.a.object,toggleCategory:r.a.func,showSingleCategory:r.a.func,format:r.a.string,position:r.a.oneOf([null,"tl","tr","bl","br"])};class c extends a.a.PureComponent{format(e){if(!this.props.format)return e;const t=parseFloat(e);return Object(s.a)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(" - ")){const t=e.split(" - ");return this.format(t[0])+" - "+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map(e=>{let[t,n]=e;const i={color:"rgba("+n.color.join(", ")+")"},o=n.enabled?"◼":"◻";return a.a.createElement("li",{key:t},a.a.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(t),onDoubleClick:()=>this.props.showSingleCategory(t)},a.a.createElement("span",{style:i},o)," ",this.formatCategoryLabel(t)))}),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return a.a.createElement("div",{className:"legend",style:t},a.a.createElement("ul",{className:"categories"},e))}}c.propTypes=l,c.defaultProps={categories:{},toggleCategory:()=>{},showSingleCategory:()=>{},format:null,position:"tr"}},763:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(827),a=n.n(i);const o=[1,0,1,0,0,0,0];function r(e,t){const n=parseInt(a()(t).format("x"),10);return parseInt(a()(t).add(e).format("x"),10)-n}function s(e,t){const n=a()(Math.min(...e)),i=a()(Math.max(...e));let s,l,c;if(t.includes("/")){const e=t.split("/",2);e[0].endsWith("Z")?(l=a()(e[0]),s=a.a.duration(e[1])):(l=a()(e[1]),s=a.a.duration(e[0]))}else s=a.a.duration(t),l=function(e,t){const n=a()(e).subtract(t),i=e.toArray(),r=n.toArray(),s=i.map((e,t)=>r[t]!==e).indexOf(!0),l=i.map((e,t)=>{if(t===s){const n=e-r[t];return e-(e-o[t])%n}return t<s||-1===s?e:o[t]});return a()(l)}(n,s);const u=n.valueOf();for(c=l.clone();c.valueOf()<u;)c.add(s);for(;c.valueOf()>u;)c.subtract(s);let d;const g=i.valueOf();for(d=l.clone();d.valueOf()>g;)d.subtract(s);for(;d.valueOf()<g;)d.add(s);const p=null!=t?[c,c.clone().add(s)]:[c,d],h=e.every(e=>null===e);return{start:parseInt(c.format("x"),10),end:parseInt(d.format("x"),10),getStep:r.bind(this,s),values:p.map(e=>parseInt(e.format("x"),10)),disabled:h}}},765:function(e,t,n){"use strict";var i=n(0),a=n.n(i),o=n(2),r=n.n(o),s=n(756),l=n(820),c=n.n(l),u=n(711),d=n(821),g=n.n(d);n(826),n(781);function p(e){return a.a.createElement("span",{className:"BootstrapSliderWrapper"},a.a.createElement(g.a,e))}n(783);const h={start:r.a.number.isRequired,step:r.a.number.isRequired,end:r.a.number.isRequired,values:r.a.array.isRequired,onChange:r.a.func,loopDuration:r.a.number,maxFrames:r.a.number,orientation:r.a.oneOf(["horizontal","vertical"]),reversed:r.a.bool,disabled:r.a.bool,range:r.a.bool};class f extends a.a.PureComponent{constructor(e){super(e),this.state={intervalId:null};const t=e.end-e.start,n=Math.min(e.maxFrames,t/e.step),i=t/n;this.intervalMilliseconds=e.loopDuration/n,this.increment=i<e.step?e.step:i-i%e.step,this.onChange=this.onChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stepBackward=this.stepBackward.bind(this),this.stepForward=this.stepForward.bind(this),this.getPlayClass=this.getPlayClass.bind(this),this.formatter=this.formatter.bind(this)}componentDidMount(){c.a.bind(["space"],this.play)}componentWillUnmount(){c.a.unbind(["space"])}onChange(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()}getPlayClass(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{const e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}}pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}stepForward(){const{start:e,end:t,step:n,values:i,disabled:a}=this.props;if(a)return;const o=(Array.isArray(i)?i:[i,i+n]).map(e=>e+this.increment),r=o[1]>t?o[0]-e:0;this.props.onChange(o.map(e=>e-r))}stepBackward(){const{start:e,end:t,step:n,values:i,disabled:a}=this.props;if(a)return;const o=(Array.isArray(i)?i:[i,i+n]).map(e=>e-this.increment),r=o[0]<e?t-o[1]:0;this.props.onChange(o.map(e=>e+r))}formatter(e){if(this.props.disabled)return Object(u.b)("Data has no time steps");let t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map(e=>new Date(e).toUTCString()).join(" : ")}render(){const{start:e,end:t,step:n,orientation:i,reversed:o,disabled:r,range:s,values:l}=this.props;return a.a.createElement("div",{className:"play-slider"},a.a.createElement("div",{className:"play-slider-controls padded"},a.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),a.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),a.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),a.a.createElement("div",{className:"play-slider-scrobbler padded"},a.a.createElement(p,{value:s?l:l[0],range:s,formatter:this.formatter,change:this.onChange,min:e,max:t,step:n,orientation:i,reversed:o,disabled:r?"disabled":"enabled"})))}}f.propTypes=h,f.defaultProps={onChange:()=>{},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0},n.d(t,"a",(function(){return m}));const v={getLayers:r.a.func.isRequired,start:r.a.number.isRequired,end:r.a.number.isRequired,getStep:r.a.func,values:r.a.array.isRequired,aggregation:r.a.bool,disabled:r.a.bool,viewport:r.a.object.isRequired,children:r.a.node,mapStyle:r.a.string,mapboxApiAccessToken:r.a.string.isRequired,setControlValue:r.a.func,onValuesChange:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired};class m extends a.a.PureComponent{render(){const{start:e,end:t,getStep:n,disabled:i,aggregation:o,children:r,getLayers:l,values:c,onValuesChange:u,viewport:d,setControlValue:g,mapStyle:p,mapboxApiAccessToken:h,height:v,width:m}=this.props,y=l(c);return a.a.createElement("div",null,a.a.createElement(s.a,{viewport:d,layers:y,setControlValue:g,mapStyle:p,mapboxApiAccessToken:h,bottomMargin:i?0:20,width:m,height:v}),!i&&a.a.createElement(f,{start:e,end:t,step:n(e),values:c,range:!o,onChange:u}),r)}}m.propTypes=v,m.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:()=>{},onValuesChange:()=>{}}},766:function(e,t,n){var i=n(342),a=n(767);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var o={insert:"head",singleton:!1},r=(i(a,o),a.locals?a.locals:{});e.exports=r},767:function(e,t,n){(t=n(343)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\ndiv.legend {\n  font-size: 90%;\n  position: absolute;\n  background: #fff;\n  box-shadow: 0 0 4px rgba(0, 0, 0, 0.15);\n  margin: 24px;\n  padding: 12px 20px;\n  outline: none;\n  overflow-y: scroll;\n  max-height: 200px;\n}\n\nul.categories {\n  list-style: none;\n  padding-left: 0;\n  margin: 0;\n}\n\nul.categories li a {\n  color: rgb(51, 51, 51);\n  text-decoration: none;\n}\n\nul.categories li a span {\n  margin-right: 10px;\n}\n',""]),e.exports=t},771:function(e,t,n){var i=n(342),a=n(772);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var o={insert:"head",singleton:!1},r=(i(a,o),a.locals?a.locals:{});e.exports=r},772:function(e,t,n){(t=n(343)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n.deckgl-tooltip > div {\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n',""]),e.exports=t},781:function(e,t,n){var i=n(342),a=n(782);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var o={insert:"head",singleton:!1},r=(i(a,o),a.locals?a.locals:{});e.exports=r},782:function(e,t,n){(t=n(343)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n.BootstrapSliderWrapper .slider-selection {\n  background: #efefef;\n}\n\n.BootstrapSliderWrapper .slider-handle {\n  background: #b3b3b3;\n}\n',""]),e.exports=t},783:function(e,t,n){var i=n(342),a=n(784);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var o={insert:"head",singleton:!1},r=(i(a,o),a.locals?a.locals:{});e.exports=r},784:function(e,t,n){(t=n(343)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n.play-slider {\n  display: flex;\n  height: 40px;\n  width: 100%;\n  margin: 0;\n}\n\n.play-slider-controls {\n  flex: 0 0 80px;\n  text-align: middle;\n}\n\n.play-slider-scrobbler {\n  flex: 1 1;\n}\n\n.slider.slider-horizontal {\n  width: 100% !important;\n}\n\n.slider-button {\n  color: #b3b3b3;\n  margin-right: 5px;\n}\n\ndiv.slider > div.tooltip.tooltip-main.top.in {\n  margin-left: 0 !important;\n}\n',""]),e.exports=t},804:function(e,t){},810:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(741),a=n(744),o=n(735),r=n(736),s=function(e){return e.length},l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;Object(o.a)(this,e),this.sortedBins=this.getSortedBins(t,n),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}return Object(r.a)(e,[{key:"getSortedBins",value:function(e,t){return e.reduce((function(e,n,i){var a=t(n.points);return null!=a&&e.push({i:Number.isFinite(n.index)?n.index:i,value:a,counts:n.points.length}),e}),[]).sort((function(e,t){return e.value-t.value}))}},{key:"getValueRange",value:function(e){var t=Object(a.a)(e,2),n=t[0],i=t[1],o=this.sortedBins.length;if(!o)return[0,0];var r=Math.ceil(n/100*(o-1)),s=Math.floor(i/100*(o-1));return[this.sortedBins[r].value,this.sortedBins[s].value]}},{key:"getMaxCount",value:function(){var e=0;return this.sortedBins.forEach((function(t){return e=e>t.counts?e:t.counts})),e}},{key:"getBinMap",value:function(){return this.sortedBins.reduce((function(e,t){return Object.assign(e,Object(i.a)({},t.i,t))}),{})}}]),e}()},811:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o}));var i=n(757);function a(e,t){return function(n){return function(e,t,n){var a=e[1]-e[0];if(a<=0)return i.a.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];var o=a/t.length,r=Math.floor((n-e[0])/o);return t[Math.max(Math.min(r,t.length-1),0)]}(e,t,n)}}function o(e,t){return function(n){return(n-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}}},849:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var i=n(735),a=n(736),o=n(738),r=n(737),s=n(748),l=n(739),c=n(813),u=n(757),d=n(791),g=function(e){function t(){return Object(i.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(a.a)(t,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(e){Object(s.a)(Object(r.a)(t.prototype),"setState",this).call(this,e),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(e){return e.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(e,t){var n=this.props._subLayerProps;return t&&t.length||n&&n[e]}},{key:"getSubLayerClass",value:function(e,t){var n=this.props._subLayerProps;return n&&n[e]&&n[e].type||t}},{key:"getSubLayerProps",value:function(e){var t=this.props,n=t.opacity,i=t.pickable,a=t.visible,o=t.parameters,r=t.getPolygonOffset,s=t.highlightedObjectIndex,l=t.autoHighlight,c=t.highlightColor,u=t.coordinateSystem,d=t.coordinateOrigin,g=t.wrapLongitude,p=t.positionFormat,h=t.modelMatrix,f=t._subLayerProps,v={opacity:n,pickable:i,visible:a,parameters:o,getPolygonOffset:r,highlightedObjectIndex:s,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:d,wrapLongitude:g,positionFormat:p,modelMatrix:h};if(e){var m=f&&f[e.id],y=m&&m.updateTriggers;Object.assign(v,e,m,{id:"".concat(this.props.id,"-").concat(e.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},e.updateTriggers,y)})}return v}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var e=this.internalState.subLayers;e&&!this.needsUpdate()?u.a.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(e=this.renderLayers(),e=Object(d.b)(e,{filter:Boolean}),this.internalState.subLayers=e,u.a.log(2,"Composite layer rendered new subLayers ".concat(this),e)());var t=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){a.value.parent=this}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}},{key:"isComposite",get:function(){return!0}}]),t}(c.a);g.layerName="CompositeLayer"},851:function(e,t,n){"use strict";var i=n(735),a=n(736),o=n(738),r=n(737),s=n(748),l=n(739),c=n(836),u=n(813),d=n(1120),g=n(964),p=n(954),h=n(777),f=n(757),v=n(1108),m=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t);var n=e.id,a=void 0===n?Object(v.c)("column-geometry"):n,s=y(e),l=s.indices,c=s.attributes;return Object(o.a)(this,Object(r.a)(t).call(this,Object(h.a)({},e,{id:a,indices:l,attributes:c})))}return Object(l.a)(t,e),t}(n(875).a);function y(e){var t=e.radius,n=e.height,i=void 0===n?1:n,a=e.nradial,o=void 0===a?10:a,r=e.vertices;f.a.assert(!r||r.length>=o);for(var s=o+1,l=3*s,c=2*Math.PI/o,u=new Uint16Array(3*o*2),d=new Float32Array(3*l),g=new Float32Array(3*l),p=0,h=0;h<s;h++)for(var v=h*c,m=r&&r[h%o],y=r&&r[(h+1)%o],b=Math.sin(v),S=Math.cos(v),x=0;x<2;x++)d[p+0]=m?m[0]:S*t,d[p+1]=m?m[1]:b*t,d[p+2]=(.5-x)*i,g[p+0]=m?y[0]-m[0]:S,g[p+1]=m?y[1]-m[1]:b,p+=3;for(var C=0;C<s;C++){var w=Math.floor(C/2)*Math.sign(C%2-.5),O=w*c,P=r&&r[(w+o)%o],j=Math.sin(O),A=Math.cos(O);d[p+0]=P?P[0]:A*t,d[p+1]=P?P[1]:j*t,d[p+2]=i/2,g[p+2]=1,p+=3}for(var k=0,D=0;D<o;D++)u[k++]=2*D+0,u[k++]=2*D+2,u[k++]=2*D+0,u[k++]=2*D+1,u[k++]=2*D+1,u[k++]=2*D+3;return{indices:u,attributes:{POSITION:{size:3,value:d},NORMAL:{size:3,value:g}}}}n.d(t,"a",(function(){return w}));var b=d.a.fp64LowPart,S=new g.a,x=[0,0,0,255],C={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,fp64:!1,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getFillColor:{type:"accessor",value:x},getLineColor:{type:"accessor",value:x},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:S,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},w=function(e){function t(){return Object(i.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(a.a)(t,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  \n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceFillColors:{size:4,type:5121,transition:!0,accessor:"getFillColor",defaultValue:x},instanceLineColors:{size:4,type:5121,transition:!0,accessor:"getLineColor",defaultValue:x},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,a=e.changeFlags;Object(s.a)(Object(r.a)(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:a});var o=n.fp64!==i.fp64;if(o){var l=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(l)}),this.getAttributeManager().invalidateAll()}(o||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices)&&this._updateGeometry(n)}},{key:"getGeometry",value:function(e,t){var n=new m({radius:1,height:2,vertices:t,nradial:e}),i=0;if(t)for(var a=0;a<e;a++){var o=t[a];i+=Math.sqrt(o[0]*o[0]+o[1]*o[1])/e}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*i}),n}},{key:"_getModel",value:function(e){return new p.a(e,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_updateGeometry",value:function(e){var t=e.diskResolution,n=e.vertices,i=this.getGeometry(t,n);this.setState({fillVertexCount:i.attributes.POSITION.value.length/3,wireframeVertexCount:i.indices.value.length}),this.state.model.setProps({geometry:i})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,a=i.lineWidthUnits,o=i.lineWidthScale,r=i.lineWidthMinPixels,s=i.lineWidthMaxPixels,l=i.elevationScale,c=i.extruded,u=i.filled,d=i.stroked,g=i.wireframe,p=i.offset,h=i.coverage,f=i.radius,v=i.angle,m=this.state,y=m.model,b=m.fillVertexCount,S=m.wireframeVertexCount,x=m.edgeDistance,C="pixels"===a?n.distanceScales.metersPerPixel[2]:1;y.setUniforms(Object.assign({},t,{radius:f,angle:v/180*Math.PI,offset:p,extruded:c,coverage:h,elevationScale:l,edgeDistance:x,widthScale:o*C,widthMinPixels:r,widthMaxPixels:s})),c&&g&&(y.setProps({isIndexed:!0}),y.setVertexCount(S).setDrawMode(1).setUniforms({isStroke:!0}).draw()),u&&(y.setProps({isIndexed:!1}),y.setVertexCount(b).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!c&&d&&(y.setProps({isIndexed:!1}),y.setVertexCount(2*b/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}},{key:"calculateInstancePositions64xyLow",value:function(e,t){var n=t.startRow,i=t.endRow,a=this.use64bitPositions();if(e.constant=!a,a){var o=this.props,r=o.data,s=o.getPosition,l=e.value,u=n*e.size,d=Object(c.a)(r,n,i),g=d.iterable,p=d.objectInfo,h=!0,f=!1,v=void 0;try{for(var m,y=g[Symbol.iterator]();!(h=(m=y.next()).done);h=!0){var S=m.value;p.index++;var x=s(S,p);l[u++]=b(x[0]),l[u++]=b(x[1])}}catch(e){f=!0,v=e}finally{try{h||null==y.return||y.return()}finally{if(f)throw v}}}else e.value=new Float32Array(2)}}]),t}(u.a);w.layerName="ColumnLayer",w.defaultProps=C},955:function(e,t,n){"use strict";n.r(t);var i=n(735),a=n(736),o=n(738),r=n(737),s=n(739),l=n(849),c=n(796),u=n(748),d=n(964),g=n(757),p=n(764),h=n(841),f=n(1120),v=n(742),m=n(806),y=n(836),b=v.a.count,S=f.a.fp64LowPart;function x(e){return Number.isFinite(e)?e:0}function C(e){var t=e.data,n=e.getPosition,i=e.cellSizeMeters,a=e.gpuGridAggregator,o=e.gpuAggregation,r=e.aggregationFlags,s=e.weightParams,l=e.fp64,c=void 0!==l&&l,u=e.coordinateSystem,d=void 0===u?m.a.LNGLAT:u,p=e.viewport,f=void 0===p?null:p,v=e.boundingBox,C=void 0===v?null:v,O={};r.dataChanged&&(C=(O=function(e,t,n){var i,a,o=b(e),r=new Float64Array(2*o),s=new Float32Array(2*o),l=1/0,c=-1/0,u=1/0,d=-1/0,g={};for(var p in n)g[p]=Object.assign({},n[p],{values:new Float32Array(3*o)});var h=Object(y.a)(e),f=h.iterable,v=h.objectInfo,m=!0,C=!1,w=void 0;try{for(var O,P=f[Symbol.iterator]();!(m=(O=P.next()).done);m=!0){var j=O.value;v.index++;var A=t(j,v),k=v.index;for(var D in a=A[0],i=A[1],r[2*k]=a,r[2*k+1]=i,s[2*k]=S(a),s[2*k+1]=S(i),n){var L=n[D].getWeight(j);Array.isArray(L)?(g[D].values[3*k]=L[0],g[D].values[3*k+1]=L[1],g[D].values[3*k+2]=L[2]):g[D].values[3*k]=L}Number.isFinite(i)&&Number.isFinite(a)&&(l=i<l?i:l,c=i>c?i:c,u=a<u?a:u,d=a>d?a:d)}}catch(e){C=!0,w=e}finally{try{m||null==P.return||P.return()}finally{if(C)throw w}}var _={xMin:x(u),xMax:x(d),yMin:x(l),yMax:x(c)};return{positions:r,positions64xyLow:s,weights:g,boundingBox:_}}(t,n,s)).boundingBox);var P=[i,i],j=[0,0];switch(g.a.assert(d===m.a.LNGLAT||d===m.a.IDENTITY),d){case m.a.LNGLAT:case m.a.LNGLAT_DEPRECATED:var A=function(e,t){var n=e.yMin,i=e.yMax;return function(e,t){var n=(r=e,r/6378e3*(180/Math.PI)),i=(a=t,o=e,o/6378e3*(180/Math.PI)/Math.cos(a*Math.PI/180));var a,o;var r;return{yOffset:n,xOffset:i}}(t,(n+i)/2)}(C,i);P=[A.xOffset,A.yOffset],j=[-180,-90];break;case m.a.IDENTITY:j=[-f.width/2,-f.height/2];break;default:g.a.assert(!1)}var k=function(e){var t=e.boundingBox,n=e.cellSize,i=e.worldOrigin,a=t.yMin,o=t.yMax,r=t.xMin,s=t.xMax,l=w(r-i[0],n[0])+i[0],c=w(a-i[1],n[1])+i[1],u=(new h.a).translate([-1*l,-1*c,0]),d=[l,c],g=s-r+n[0],p=o-a+n[1],f=[Math.ceil(g/n[0]),Math.ceil(p/n[1])];return{gridOrigin:d,gridSize:f,width:g,height:p,gridTransformMatrix:u}}({boundingBox:C,cellSize:P,worldOrigin:j});return{weights:a.run({positions:O.positions,positions64xyLow:O.positions64xyLow,weights:O.weights,cellSize:P,width:k.width,height:k.height,gridTransformMatrix:k.gridTransformMatrix,useGPU:o,changeFlags:r,fp64:c}),gridSize:k.gridSize,gridOrigin:k.gridOrigin,cellSize:P,boundingBox:C}}function w(e,t){var n=e<0?-1:1,i=n<0?Math.abs(e)+t:Math.abs(e);return(i=Math.floor(i/t)*t)*n}var O=n(770),P=n(813),j=n(954),A=n(777),k=n(875),D=n(1108),L=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),_=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),E=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),M=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),I={POSITION:{size:3,value:new Float32Array(_)},NORMAL:{size:3,value:new Float32Array(E)},TEXCOORD_0:{size:2,value:new Float32Array(M)}},R=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t);var n=e.id,a=void 0===n?Object(D.c)("cube-geometry"):n;return Object(o.a)(this,Object(r.a)(t).call(this,Object(A.a)({},e,{id:a,indices:{size:1,value:new Uint16Array(L)},attributes:Object(A.a)({},I,e.attributes)})))}return Object(s.a)(t,e),t}(k.a),F=f.a.fp64LowPart,V=new d.a,z={colorDomain:null,colorRange:O.b,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",min:0,value:[1,1]},gridOrigin:{type:"array",min:0,value:[0,0]},gridOffset:{type:"array",min:0,value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",min:0,value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,fp64:!1,material:V},T=function(e){function t(){return Object(i.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getShaders",value:function(){return{vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 normals;\n\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\n\nlayout(std140) uniform;\nuniform ColorData\n{\n  vec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\n  vec4 maxMinCount;\n} elevationData;\n\n#define EPSILON 0.00001\nout vec4 vColor;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  return outColor;\n}\n\nfloat linearScale(vec2 domain, vec2 range, float value) {\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n  }\n  return -1.;\n}\n\nvoid main(void) {\n\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\n\n  float elevation = 0.0;\n\n  if (extruded) {\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\n\n  int yIndex = (gl_InstanceID / gridSize[0]);\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\n\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\n  vec2 centroidPosition64xyLow = vec2(instancePositionXFP64[1], instancePositionYFP64[1]);\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\n  picking_setPickingColor(instancePickingColors);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(normals);\n\n   if (extruded) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\n  }\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vColor;\n  fragColor = picking_filterColor(fragColor);\n}\n",modules:["project32","gouraud-lighting","picking","fp64"]}}},{key:"initializeState",value:function(){var e=this.context.gl;this.getAttributeManager().addInstanced({colors:{size:4,update:this.calculateColors,noAlloc:!0},elevations:{size:4,update:this.calculateElevations,noAlloc:!0}});var t=this._getModel(e);this._setupUniformBuffer(t),this.setState({model:t})}},{key:"_getModel",value:function(e){return new j.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new R,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.data,a=n.cellSize,o=n.offset,r=n.extruded,s=n.elevationScale,l=n.coverage,c=n.gridSize,u=n.gridOrigin,d=n.gridOffset,g=n.colorRange,p=n.elevationRange,h=[F(u[0]),F(u[1])],f=[F(d[0]),F(d[1])],v=i.color.maxMinBuffer,m=i.elevation.maxMinBuffer;v.bind({target:35345,index:0}),m.bind({target:35345,index:1});var y=this.getDomainUniforms();this.state.model.setUniforms(Object.assign({},t,y,{cellSize:a,offset:o,extruded:r,elevationScale:s,coverage:l,gridSize:c,gridOrigin:u,gridOriginLow:h,gridOffset:d,gridOffsetLow:f,colorRange:g,elevationRange:p})).draw(),v.unbind({target:35345,index:0}),m.unbind({target:35345,index:1})}},{key:"calculateColors",value:function(e){var t=this.props.data;e.update({buffer:t.color.aggregationBuffer})}},{key:"calculateElevations",value:function(e){var t=this.props.data;e.update({buffer:t.elevation.aggregationBuffer})}},{key:"getDomainUniforms",value:function(){var e=this.props,t=e.colorDomain,n=e.elevationDomain,i={};return null!==t?(i.colorDomainValid=!0,i.colorDomain=t):i.colorDomainValid=!1,null!==n?(i.elevationDomainValid=!0,i.elevationDomain=n):i.elevationDomainValid=!1,i}},{key:"_setupUniformBuffer",value:function(e){var t=this.context.gl,n=e.program.handle,i=t.getUniformBlockIndex(n,"ColorData"),a=t.getUniformBlockIndex(n,"ElevationData");t.uniformBlockBinding(n,i,0),t.uniformBlockBinding(n,a,1)}}]),t}(P.a);T.layerName="GPUGridCellLayer",T.defaultProps=z;var N=n(744);function U(e,t,n){var i=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,a=1/0,o=-1/0,r=Object(y.a)(t),s=r.iterable,l=r.objectInfo,c=!0,u=!1,d=void 0;try{for(var g,p=s[Symbol.iterator]();!(c=(g=p.next()).done);c=!0){var h=g.value;l.index++,e=i(h,l)[1],Number.isFinite(e)&&(a=e<a?e:a,o=e>o?e:o)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}var f=(a+o)/2,v=B(n,f);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var m={};l.index=-1;var b=!0,S=!1,x=void 0;try{for(var C,w=s[Symbol.iterator]();!(b=(C=w.next()).done);b=!0){var O=C.value;l.index++;var P=i(O,l),j=Object(N.a)(P,2),A=j[0],k=j[1];if(Number.isFinite(k)&&Number.isFinite(A)){var D=Math.floor((k+90)/v.yOffset),L=Math.floor((A+180)/v.xOffset),_="".concat(D,"-").concat(L);m[_]=m[_]||{count:0,points:[]},m[_].count+=1,m[_].points.push(O)}}}catch(e){S=!0,x=e}finally{try{b||null==w.return||w.return()}finally{if(S)throw x}}return{gridHash:m,gridOffset:v}}(e,t,n),a=i.gridHash,o=i.gridOffset;return{gridHash:a,gridOffset:o,layerData:function(e,t){return Object.keys(e).reduce((function(n,i,a){var o=i.split("-"),r=parseInt(o[0],10),s=parseInt(o[1],10);return n.push(Object.assign({index:a,position:[t.xOffset*s-180,t.yOffset*r-90]},e[i])),n}),[])}(a,o)}}function B(e,t){var n;return{yOffset:e/6378e3*(180/Math.PI),xOffset:(n=t,e/6378e3*(180/Math.PI)/Math.cos(n*Math.PI/180))}}var W=new d.a,G={colorDomain:null,colorRange:O.b,getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(e){return e.position}},extruded:!1,fp64:!1,material:W,gpuAggregation:!0},q=function(e){function t(){return Object(i.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"initializeState",value:function(){var e=this.context.gl,t=c.a.isSupported(e);t||g.a.error("GPUGridLayer is not supported on this browser, use GridLayer instead")();var n={id:"".concat(this.id,"-gpu-aggregator"),shaderCache:this.context.shaderCache};this.state={gpuGridAggregator:new c.a(e,n),isSupported:t}}},{key:"updateState",value:function(e){var t=this.getAggregationFlags(e);t&&(this.getLayerData(t),this.setState({gridHash:null}))}},{key:"finalizeState",value:function(){Object(u.a)(Object(r.a)(t.prototype),"finalizeState",this).call(this),this.state.gpuGridAggregator.delete()}},{key:"getAggregationFlags",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags,a=null;return!!this.state.isSupported&&(this.isDataChanged({oldProps:t,props:n,changeFlags:i})&&(a=Object.assign({},a,{dataChanged:!0})),t.cellSize!==n.cellSize&&(a=Object.assign({},a,{cellSizeChanged:!0})),a)}},{key:"isDataChanged",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags;return!!i.dataChanged||(t.gpuAggregation!==n.gpuAggregation||(t.colorAggregation!==n.colorAggregation||t.elevationAggregation!==n.elevationAggregation||!(!i.updateTriggersChanged||!(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition||i.updateTriggersChanged.getColorWeight||i.updateTriggersChanged.getElevationWeight))))}},{key:"getHashKeyForIndex",value:function(e){var t=this.state,n=t.gridSize,i=t.gridOrigin,a=t.cellSize,o=Math.floor(e/n[0]),r=e-o*n[0],s=Math.floor((o*a[1]+i[1]+90+a[1]/2)/a[1]),l=Math.floor((r*a[0]+i[0]+180+a[0]/2)/a[0]);return"".concat(s,"-").concat(l)}},{key:"getPositionForIndex",value:function(e){var t=this.state,n=t.gridSize,i=t.gridOrigin,a=t.cellSize,o=Math.floor(e/n[0]),r=e-o*n[0],s=o*a[1]+i[1];return[r*a[0]+i[0],s]}},{key:"getPickingInfo",value:function(e){var t=e.info,n=e.mode,i=t.index,a=null;if(i>=0){var o=this.state.gpuGridAggregator,r=this.getPositionForIndex(i),s=c.a.getAggregationData(Object.assign({pixelIndex:i},o.getData("color"))),l=c.a.getAggregationData(Object.assign({pixelIndex:i},o.getData("elevation")));if(a={colorValue:s.cellWeight,elevationValue:l.cellWeight,count:s.cellCount||l.cellCount,position:r,totalCount:s.totalCount||l.totalCount},"hover"!==n){var u=this.props,d=u.data,g=u.getPosition,p=this.state.gridHash;if(!p)p=U(d,this.props.cellSize,g).gridHash,this.setState({gridHash:p});var h=p[this.getHashKeyForIndex(i)];Object.assign(a,h)}}return Object.assign(t,{picked:Boolean(a),object:a})}},{key:"getLayerData",value:function(e){var t=this.props,n=t.data,i=t.cellSize,a=t.getPosition,o=t.gpuAggregation,r=t.getColorWeight,s=t.colorAggregation,l=t.getElevationWeight,c=t.elevationAggregation,u=t.fp64,d=C({data:n,cellSizeMeters:i,getPosition:a,weightParams:{color:{getWeight:r,operation:p.a[s]||p.a[G.colorAggregation],needMin:!0,needMax:!0,combineMaxMin:!0},elevation:{getWeight:l,operation:p.a[c]||p.a[G.elevationAggregation],needMin:!0,needMax:!0,combineMaxMin:!0}},gpuAggregation:o,gpuGridAggregator:this.state.gpuGridAggregator,boundingBox:this.state.boundingBox,aggregationFlags:e,fp64:u}),g=d.weights,h=d.gridSize,f=d.gridOrigin,v=d.cellSize,m=d.boundingBox;this.setState({weights:g,gridSize:h,gridOrigin:f,cellSize:v,boundingBox:m})}},{key:"renderLayers",value:function(){if(!this.state.isSupported)return null;var e=this.props,t=e.elevationScale,n=e.fp64,i=e.extruded,a=e.cellSize,o=e.coverage,r=e.material,s=e.elevationRange,l=e.colorDomain,c=e.elevationDomain,u=this.state,d=u.weights,g=u.gridSize,p=u.gridOrigin,h=u.cellSize,f=Object(O.a)(this.props.colorRange,Float32Array,255);return new(this.getSubLayerClass("gpu-grid-cell",T))({gridSize:g,gridOrigin:p,gridOffset:h,colorRange:f,elevationRange:s,colorDomain:l,elevationDomain:c,fp64:n,cellSize:a,coverage:o,material:r,elevationScale:t,extruded:i},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:d,numInstances:g[0]*g[1]})}}]),t}(l.a);q.layerName="GPUGridLayer",q.defaultProps=G;var H=function(e){function t(){return Object(i.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getGeometry",value:function(e){return new R}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.elevationScale,a=n.extruded,o=n.offset,r=n.coverage,s=n.cellSize,l=n.angle;this.state.model.setUniforms(Object.assign({},t,{radius:s/2,angle:l,offset:o,extruded:a,coverage:r,elevationScale:i,edgeDistance:1,isWireframe:!1})).draw()}}]),t}(n(851).a);H.layerName="GridCellLayer",H.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};var Y=n(810),K=n(811);function X(){}var J=new d.a,Z={colorDomain:null,colorRange:O.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},onSetColorDomain:X,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:1,onSetElevationDomain:X,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(e){return e.position}},extruded:!1,fp64:!1,material:J},Q=["getColorValue","colorAggregation","getColorWeight"],$=["getElevationValue","elevationAggregation","getElevationWeight"],ee=function(e){function t(){return Object(i.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"initializeState",value:function(){this.state={layerData:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:X,elevationScaleFunc:X,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(e){var t=this,n=e.oldProps,i=e.props,a=e.changeFlags;this.updateGetValueFuncs(n,i);var o=this.needsReProjectPoints(n,i,a);a.dataChanged||o?this.getLayerData():(this.getDimensionChanges(n,i)||[]).forEach((function(e){return"function"==typeof e&&e.apply(t)}))}},{key:"colorElevationPropsChanged",value:function(e,t){for(var n=!1,i=!1,a=0;a<Q.length;a++){var o=Q[a];e[o]!==t[o]&&(n=!0)}for(var r=0;r<$.length;r++){var s=$[r];e[s]!==t[s]&&(i=!0)}return{colorChanged:n,elevationChanged:i}}},{key:"updateGetValueFuncs",value:function(e,t){var n=t.getColorValue,i=t.getElevationValue,a=this.props,o=a.colorAggregation,r=a.getColorWeight,s=a.elevationAggregation,l=a.getElevationWeight,c=this.colorElevationPropsChanged(e,t),u=c.colorChanged,d=c.elevationChanged;u&&null===n&&(n=Object(p.b)(o,r)),d&&null===i&&(i=Object(p.b)(s,l)),n&&this.setState({getColorValue:n}),i&&this.setState({getElevationValue:i})}},{key:"needsReProjectPoints",value:function(e,t,n){return e.cellSize!==t.cellSize||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(e,t){var n=this.state.dimensionUpdaters,i=[];for(var a in n){var o=n[a].find((function(n){return n.triggers.some((function(n){return e[n]!==t[n]}))}));o&&i.push(o.updater)}return i.length?i:null}},{key:"getPickingInfo",value:function(e){var t=e.info,n=this.state,i=n.sortedColorBins,a=n.sortedElevationBins,o=null;if(t.picked&&t.index>-1){var r=this.state.layerData[t.index],s=i.binMap[r.index]&&i.binMap[r.index].value,l=a.binMap[r.index]&&a.binMap[r.index].value;o=Object.assign({colorValue:s,elevationValue:l},r)}return Object.assign(t,{picked:Boolean(o),object:o})}},{key:"getUpdateTriggers",value:function(){var e=this,t=this.state.dimensionUpdaters,n={},i=function(i){n[i]={};var a=!0,o=!1,r=void 0;try{for(var s,l=t[i][Symbol.iterator]();!(a=(s=l.next()).done);a=!0){s.value.triggers.forEach((function(t){n[i][t]=e.props[t]}))}}catch(e){o=!0,r=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw r}}};for(var a in t)i(a);return n}},{key:"getLayerData",value:function(){var e=this.props,t=U(e.data,e.cellSize,e.getPosition).layerData;this.setState({layerData:t}),this.getSortedBins()}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var e=this.state.getColorValue,t=new Y.a(this.state.layerData||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var e=this.state.getElevationValue,t=new Y.a(this.state.layerData||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var e=this.props,t=e.lowerPercentile,n=e.upperPercentile,i=e.onSetColorDomain;this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var e=this.props,t=e.elevationLowerPercentile,n=e.elevationUpperPercentile,i=e.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var e=this.props.colorRange,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Object(K.b)(t,e)}},{key:"getElevationScale",value:function(){var e=this.props.elevationRange,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Object(K.a)(t,e)}},{key:"_onGetSublayerColor",value:function(e){var t=this.state,n=t.sortedColorBins,i=t.colorScaleFunc,a=t.colorValueDomain,o=n.binMap[e.index]&&n.binMap[e.index].value,r=this.props.colorDomain||a,s=o>=r[0]&&o<=r[r.length-1]?i(o):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(e){var t=this.state,n=t.sortedElevationBins,i=t.elevationScaleFunc,a=t.elevationValueDomain,o=n.binMap[e.index]&&n.binMap[e.index].value,r=this.props.elevationDomain||a;return o>=r[0]&&o<=r[r.length-1]?i(o):-1}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,n=e.fp64,i=e.extruded,a=e.cellSize,o=e.coverage,r=e.material,s=e.transitions;return new(this.getSubLayerClass("grid-cell",H))({fp64:n,cellSize:a,coverage:o,material:r,elevationScale:t,extruded:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.layerData})}}]),t}(l.a);ee.layerName="CPUGridLayer",ee.defaultProps=Z;var te=Object.assign({},q.defaultProps,ee.defaultProps,{gpuAggregation:!1}),ne=function(e){function t(){return Object(i.a)(this,t),Object(o.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"initializeState",value:function(){this.state={useGPUAggregation:!0}}},{key:"updateState",value:function(e){e.oldProps;var t=e.props,n=(e.changeFlags,{});n.useGPUAggregation=this.canUseGPUAggregation(t),this.setState(n)}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e.updateTriggers,i=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",q):this.getSubLayerClass("CPU",ee))(this.props,this.getSubLayerProps({id:i,updateTriggers:n}),{data:t})}},{key:"canUseGPUAggregation",value:function(e){var t=e.gpuAggregation,n=e.lowerPercentile,i=e.upperPercentile,a=e.getColorValue,o=e.getElevationValue;return!!t&&(!!c.a.isSupported(this.context.gl)&&(0===n&&100===i&&(null===a&&null===o)))}}]),t}(l.a);ne.layerName="GridLayer",ne.defaultProps=te;var ie=n(0),ae=n.n(ie),oe=n(711),re=n(745),se=n(747),le=n(761),ce=n(753);function ue(){return(ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function de(e){return ae.a.createElement("div",{className:"deckgl-tooltip"},ae.a.createElement(ce.a,{label:Object(oe.b)("Longitude and Latitude")+": ",value:e.coordinate[0]+", "+e.coordinate[1]}),ae.a.createElement(ce.a,{label:Object(oe.b)("Height")+": ",value:""+e.object.elevationValue}))}function ge(e,t,n,i){const a=e,o=a.color_picker;let r=t.data.features.map(e=>ue({},e,{color:[o.r,o.g,o.b,255*o.a]}));if(a.js_data_mutator){r=Object(se.a)(a.js_data_mutator)(r)}const s=Object(re.c)(a.js_agg_function,e=>e.weight);return new ne(ue({id:"grid-layer-"+a.slice_id,data:r,pickable:!0,cellSize:a.grid_size,minColor:[0,0,0,0],extruded:a.extruded,maxColor:[o.r,o.g,o.b,255*o.a],outline:!1,getElevationValue:s,getColorValue:s},Object(re.a)(a,i,de)))}n.d(t,"getLayer",(function(){return ge}));t.default=Object(le.b)(ge,(function(e){return e.map(e=>e.position)}))},964:function(e,t,n){"use strict";var i=n(735),a=n(738),o=n(737),r=n(746),s=n(739);n.d(t,"a",(function(){return c}));var l={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},c=function(e){function t(e){var n;return Object(i.a)(this,t),n=Object(a.a)(this,Object(o.a)(t).call(this,e)),e=Object.assign({},l,e),Object.assign(Object(r.a)(n),e),n}return Object(s.a)(t,e),t}((function e(){Object(i.a)(this,e)}))}}]);