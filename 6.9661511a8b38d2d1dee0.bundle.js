(window.webpackJsonp=window.webpackJsonp||[]).push([[6,2,7,14,15],{688:function(e,t,r){"use strict";r.d(t,"b",(function(){return u})),r.d(t,"a",(function(){return p})),r.d(t,"c",(function(){return f}));var n=r(911),a=r(701),o=r(693);function i(){return(i=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}var s=.25,l={LAT_MAX:90,LAT_MIN:-90,LNG_MAX:180,LNG_MIN:-180};function c(e){var t=a.extent(e,(function(e){return e[1]})),r=a.extent(e,(function(e){return e[0]})),n=t[0]===t[1]?function(e){return[e[0]-s<l.LAT_MIN?l.LAT_MIN:e[0]-s,e[1]+s>l.LAT_MAX?l.LAT_MAX:e[1]+s]}(t):t,o=r[0]===r[1]?function(e){return[e[0]-s<l.LNG_MIN?l.LNG_MIN:e[0]-s,e[1]+s>l.LNG_MAX?l.LNG_MAX:e[1]+s]}(r):r;return[[o[0],n[0]],[o[1],n[1]]]}function u(e,t,r){void 0===r&&(r=10);try{var a=c(t);return i({},e,{},Object(n.a)({bounds:a,height:e.height,padding:r,width:e.width}))}catch(t){return console.error("Could not auto zoom",t),e}}function p(e,t,r,n){var a,i,s=e,l=r;return s.js_tooltip&&(l=Object(o.a)(s.js_tooltip)),l&&(a=function(e){e.picked?t({content:l(e),x:e.x,y:e.y+30}):t(null)}),s.js_onclick_href?i=function(e){var t=Object(o.a)(s.js_onclick_href)(e);window.open(t)}:s.table_filter&&void 0!==n&&(i=function(e){return n(e.object[s.line_column])}),{onClick:i,onHover:a,pickable:!!a}}var d={p1:.01,p5:.05,p95:.95,p99:.99};function f(e,t){return void 0===e&&(e="sum"),void 0===t&&(t=null),"count"===e?function(e){return e.length}:(r=e in d?function(r,n){var o;return o=t?r.sort((function(e,r){return a.ascending(t(e),t(r))})):r.sort(a.ascending),a.quantile(o,d[e],n)}:a[e],t?function(e){return r(e.map(t))}:function(e){return r(e)});var r}},693:function(e,t,r){"use strict";r.d(t,"a",(function(){return p}));var n=r(769),a=r.n(n),o=r(770),i=r.n(o),s=r(701),l=r(702);function c(){return(c=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}var u={console:console,_:i.a,colors:l,d3array:s};function p(e,t,r){var n={},o="SAFE_EVAL_"+Math.floor(1e6*Math.random());n[o]={};var i=c({},u,{},t);Object.keys(i).forEach((function(e){n[e]=i[e]}));try{return a.a.runInNewContext(o+"="+e,n,r),n[o]}catch(e){return function(){return e}}}},700:function(e,t,r){"use strict";r.d(t,"a",(function(){return l}));var n=r(0),a=r.n(n),o=r(2),i=r.n(o);var s={label:i.a.string.isRequired,value:i.a.string.isRequired},l=function(e){function t(){return e.apply(this,arguments)||this}return function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e),t.prototype.render=function(){var e=this.props,t=e.label,r=e.value;return a.a.createElement("div",null,t,a.a.createElement("strong",null,r))},t}(a.a.PureComponent);l.propTypes=s},702:function(e,t,r){"use strict";r.r(t),r.d(t,"hexToRGB",(function(){return a}));var n=r(18);function a(e,t){if(void 0===t&&(t=255),!e)return[0,0,0,t];var r=Object(n.f)(e);return[r.r,r.g,r.b,t]}},703:function(e,t,r){"use strict";var n=r(0),a=r.n(n),o=r(2),i=r.n(o),s=r(713),l=r(705),c=r(680),u=r(712),p=r(704),d=r(702),f=r(711),h=r(693),g=r(688);function m(){return(m=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var v=c.a.getScale;var y={formData:i.a.object.isRequired,mapboxApiKey:i.a.string.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,getLayer:i.a.func.isRequired,getPoints:i.a.func.isRequired,payload:i.a.object.isRequired,onAddFilter:i.a.func,setTooltip:i.a.func},_=function(e){function t(t){var r;return(r=e.call(this,t)||this).state=r.getStateFromProps(t),r.getLayers=r.getLayers.bind(b(r)),r.onValuesChange=r.onValuesChange.bind(b(r)),r.onViewportChange=r.onViewportChange.bind(b(r)),r.toggleCategory=r.toggleCategory.bind(b(r)),r.showSingleCategory=r.showSingleCategory.bind(b(r)),r}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var r=t.prototype;return r.UNSAFE_componentWillReceiveProps=function(e){e.payload.form_data!==this.state.formData&&this.setState(m({},this.getStateFromProps(e)))},r.onValuesChange=function(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})},r.onViewportChange=function(e){this.setState({viewport:e})},r.getStateFromProps=function(e,t){var r=e.payload.data.features||[],n=r.map((function(e){return e.__timestamp})),a=function(e,t){var r=e.color_picker||{r:0,g:0,b:0,a:1},n=[r.r,r.g,r.b,255*r.a],a=v(e.color_scheme),o={};return t.forEach((function(t){var i;null==t.cat_color||o.hasOwnProperty(t.cat_color)||(i=e.dimension?Object(d.hexToRGB)(a(t.cat_color),255*r.a):n,o[t.cat_color]={color:i,enabled:!0})})),o}(e.formData,r);if(t&&e.payload.form_data===t.formData)return m({},t,{categories:a});var o=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",i=Object(f.a)(n,o);return{start:i.start,end:i.end,getStep:i.getStep,values:i.values,disabled:i.disabled,viewport:e.formData.autozoom?Object(g.b)(e.viewport,e.getPoints(r)):e.viewport,selected:[],lastClick:0,formData:e.payload.form_data,categories:a}},r.getLayers=function(e){var t=this.props,r=t.getLayer,n=t.payload,a=t.formData,o=t.onAddFilter,i=t.setTooltip,s=n.data.features?[].concat(n.data.features):[];(s=this.addColor(s,a),a.js_data_mutator)&&(s=Object(h.a)(a.js_data_mutator)(s));s=e[0]===e[1]||e[1]===this.end?s.filter((function(t){return t.__timestamp>=e[0]&&t.__timestamp<=e[1]})):s.filter((function(t){return t.__timestamp>=e[0]&&t.__timestamp<e[1]}));var l=this.state.categories;return a.dimension&&(s=s.filter((function(e){return l[e.cat_color]&&l[e.cat_color].enabled}))),[r(a,m({},n,{data:m({},n.data,{features:s})}),o,i)]},r.addColor=function(e,t){var r=t.color_picker||{r:0,g:0,b:0,a:1},n=v(t.color_scheme);return e.map((function(e){return t.dimension?m({},e,{color:Object(d.hexToRGB)(n(e.cat_color),255*r.a)}):e}))},r.toggleCategory=function(e){var t,r=this.state.categories[e],n=m({},this.state.categories,((t={})[e]=m({},r,{enabled:!r.enabled}),t));Object.values(n).every((function(e){return!e.enabled}))&&Object.values(n).forEach((function(e){e.enabled=!0})),this.setState({categories:n})},r.showSingleCategory=function(e){var t=m({},this.state.categories);Object.values(t).forEach((function(e){e.enabled=!1})),t[e].enabled=!0,this.setState({categories:t})},r.render=function(){return a.a.createElement("div",{style:{position:"relative"}},a.a.createElement(u.a,{getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,onValuesChange:this.onValuesChange,disabled:this.state.disabled,viewport:this.state.viewport,onViewportChange:this.onViewportChange,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue},a.a.createElement(p.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))},t}(a.a.PureComponent);function w(){return(w=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}_.propTypes=y,r.d(t,"b",(function(){return O})),r.d(t,"a",(function(){return S}));var C={formData:i.a.object.isRequired,payload:i.a.object.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,onAddFilter:i.a.func,setTooltip:i.a.func},j={onAddFilter:function(){},setTooltip:function(){}};function O(e,t){var r=function(r){function n(e){var n=r.call(this,e)||this,a=e.viewport,o=e.formData.autozoom?Object(g.b)(a,t(e.payload.data.features)):a;return n.state={viewport:o,layer:n.computeLayer(e)},n.onViewportChange=n.onViewportChange.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(n)),n}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(n,r);var o=n.prototype;return o.UNSAFE_componentWillReceiveProps=function(e){var t=w({},e.formData,{viewport:null}),r=w({},this.props.formData,{viewport:null});Object(s.isEqual)(t,r)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})},o.onViewportChange=function(e){this.setState({viewport:e})},o.computeLayer=function(t){var r=t.formData,n=t.payload,a=t.onAddFilter,o=t.setTooltip;return e(r,n,a,o)},o.render=function(){var e=this.props,t=e.formData,r=e.payload,n=e.setControlValue,o=this.state,i=o.layer,s=o.viewport;return a.a.createElement(l.a,{mapboxApiAccessToken:r.data.mapboxApiKey,viewport:s,layers:[i],mapStyle:t.mapbox_style,setControlValue:n,onViewportChange:this.onViewportChange})},n}(a.a.PureComponent);return r.propTypes=C,r.defaultProps=j,r}function S(e,t){function r(r){var n=r.formData,o=r.payload,i=r.setControlValue,s=r.onAddFilter,l=r.setTooltip,c=r.viewport;return a.a.createElement(_,{formData:n,mapboxApiKey:o.data.mapboxApiKey,setControlValue:i,viewport:c,getLayer:e,payload:o,onAddFilter:s,setTooltip:l,getPoints:t})}return r.propTypes=C,r.defaultProps=j,r}},704:function(e,t,r){"use strict";r.d(t,"a",(function(){return c}));var n=r(0),a=r.n(n),o=r(2),i=r.n(o),s=r(742);r(706);var l={categories:i.a.object,toggleCategory:i.a.func,showSingleCategory:i.a.func,format:i.a.string,position:i.a.oneOf([null,"tl","tr","bl","br"])},c=function(e){function t(){return e.apply(this,arguments)||this}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var r=t.prototype;return r.format=function(e){if(!this.props.format)return e;var t=parseFloat(e);return Object(s.a)(this.props.format,t)},r.formatCategoryLabel=function(e){if(!this.props.format)return e;if(e.includes(" - ")){var t=e.split(" - ");return this.format(t[0])+" - "+this.format(t[1])}return this.format(e)},r.render=function(){var e,t=this;if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;var r=Object.entries(this.props.categories).map((function(e){var r=e[0],n=e[1],o={color:"rgba("+n.color.join(", ")+")"},i=n.enabled?"◼":"◻";return a.a.createElement("li",{key:r},a.a.createElement("a",{href:"#",onClick:function(){return t.props.toggleCategory(r)},onDoubleClick:function(){return t.props.showSingleCategory(r)}},a.a.createElement("span",{style:o},i)," ",t.formatCategoryLabel(r)))})),n="t"===this.props.position.charAt(0)?"top":"bottom",o="r"===this.props.position.charAt(1)?"right":"left",i=((e={position:"absolute"})[n]="0px",e[o]="10px",e);return a.a.createElement("div",{className:"legend",style:i},a.a.createElement("ul",{className:"categories"},r))},t}(a.a.PureComponent);c.propTypes=l,c.defaultProps={categories:{},toggleCategory:function(){},showSingleCategory:function(){},format:null,position:"tr"}},705:function(e,t,r){"use strict";r.d(t,"a",(function(){return h}));var n=r(0),a=r.n(n),o=r(2),i=r.n(o),s=r(791),l=r(699),c=(r(773),r(713));r(736);function u(){return(u=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var d=2e3,f={viewport:i.a.object.isRequired,layers:i.a.array.isRequired,setControlValue:i.a.func,mapStyle:i.a.string,mapboxApiAccessToken:i.a.string.isRequired,onViewportChange:i.a.func},h=function(e){function t(t){var r;return(r=e.call(this,t)||this).tick=r.tick.bind(p(r)),r.onViewportChange=r.onViewportChange.bind(p(r)),r.state={previousViewport:t.viewport,timer:setInterval(r.tick,d)},r}(function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t})(t,e),t.getDerivedStateFromProps=function(e,t){return e.viewport===t.viewport?null:{viewport:u({},e.viewport),previousViewport:t.viewport}};var r=t.prototype;return r.componentWillUnmount=function(){clearInterval(this.state.timer)},r.onViewportChange=function(e){var t=Object.assign({},e),r=u({},this.state.previousViewport,{},t);this.props.onViewportChange(r)},r.tick=function(){var e=this;if(this.state&&!Object(c.isEqual)(this.state.previousViewport,this.props.viewport)){var t=this.props.setControlValue,r=this.props.viewport;t&&t("viewport",r),this.setState((function(){return{previousViewport:e.props.viewport}}))}},r.layers=function(){return this.props.layers.some((function(e){return"function"==typeof e}))?this.props.layers.map((function(e){return"function"==typeof e?e():e})):this.props.layers},r.render=function(){var e=this.props.viewport;return a.a.createElement(s.a,u({},e,{mapStyle:this.props.mapStyle,onViewportChange:this.onViewportChange,mapboxApiAccessToken:this.props.mapboxApiAccessToken}),a.a.createElement(l.i,u({},e,{layers:this.layers(),initWebGLParameters:!0})))},t}(a.a.Component);h.propTypes=f,h.defaultProps={mapStyle:"light",onViewportChange:function(){},setControlValue:function(){}}},706:function(e,t,r){var n=r(707);"string"==typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r(334)(n,a);n.locals&&(e.exports=n.locals)},707:function(e,t,r){(e.exports=r(333)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\ndiv.legend {\n    font-size: 90%;\n    position: absolute;\n    background: #fff;\n    box-shadow: 0 0 4px rgba(0, 0, 0, 0.15);\n    margin: 24px;\n    padding: 12px 20px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n}\n\nul.categories {\n    list-style: none;\n    padding-left: 0;\n    margin: 0;\n}\n\nul.categories li a {\n    color: rgb(51, 51, 51);\n    text-decoration: none;\n}\n\nul.categories li a span {\n    margin-right: 10px;\n}\n',""])},711:function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));var n=r(835),a=r.n(n),o=[1,0,1,0,0,0,0];function i(e,t){var r=parseInt(a()(t).format("x"),10);return parseInt(a()(t).add(e).format("x"),10)-r}function s(e,t){var r,n,s=a()(Math.min.apply(Math,e)),l=a()(Math.max.apply(Math,e));if(-1!==t.indexOf("/")){var c=t.split("/",2);c[0].endsWith("Z")?(n=a()(c[0]),r=a.a.duration(c[1])):(n=a()(c[1]),r=a.a.duration(c[0]))}else n=function(e,t){var r=a()(e).subtract(t),n=e.toArray(),i=r.toArray(),s=n.map((function(e,t){return i[t]!==e})).indexOf(!0),l=n.map((function(e,t){if(t===s){var r=e-i[t];return e-(e-o[t])%r}return t<s||-1===s?e:o[t]}));return a()(l)}(s,r=a.a.duration(t));var u,p=s.valueOf();for(u=n.clone();u.valueOf()<p;)u.add(r);for(;u.valueOf()>p;)u.subtract(r);var d,f=l.valueOf();for(d=n.clone();d.valueOf()>f;)d.subtract(r);for(;d.valueOf()<f;)d.add(r);var h=null==t?[u,d]:[u,u.clone().add(r)],g=e.every((function(e){return null===e}));return{start:parseInt(u.format("x"),10),end:parseInt(d.format("x"),10),getStep:i.bind(this,r),values:h.map((function(e){return parseInt(e.format("x"),10)})),disabled:g}}},712:function(e,t,r){"use strict";var n=r(0),a=r.n(n),o=r(2),i=r.n(o),s=r(705),l=r(816),c=r.n(l),u=r(679),p=r(817),d=r.n(p);r(834),r(787);function f(e){return a.a.createElement("span",{className:"BootstrapSliderWrapper"},a.a.createElement(d.a,e))}r(789);function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var g={start:i.a.number.isRequired,step:i.a.number.isRequired,end:i.a.number.isRequired,values:i.a.array.isRequired,onChange:i.a.func,loopDuration:i.a.number,maxFrames:i.a.number,orientation:i.a.oneOf(["horizontal","vertical"]),reversed:i.a.bool,disabled:i.a.bool,range:i.a.bool},m=function(e){function t(t){var r;(r=e.call(this,t)||this).state={intervalId:null};var n=t.end-t.start,a=Math.min(t.maxFrames,n/t.step),o=n/a;return r.intervalMilliseconds=t.loopDuration/a,r.increment=o<t.step?t.step:o-o%t.step,r.onChange=r.onChange.bind(h(r)),r.play=r.play.bind(h(r)),r.pause=r.pause.bind(h(r)),r.stepBackward=r.stepBackward.bind(h(r)),r.stepForward=r.stepForward.bind(h(r)),r.getPlayClass=r.getPlayClass.bind(h(r)),r.formatter=r.formatter.bind(h(r)),r}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var r=t.prototype;return r.componentDidMount=function(){c.a.bind(["space"],this.play)},r.componentWillUnmount=function(){c.a.unbind(["space"])},r.onChange=function(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()},r.getPlayClass=function(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"},r.play=function(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{var e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}},r.pause=function(){clearInterval(this.state.intervalId),this.setState({intervalId:null})},r.stepForward=function(){var e=this,t=this.props,r=t.start,n=t.end,a=t.step,o=t.values;if(!t.disabled){var i=(Array.isArray(o)?o:[o,o+a]).map((function(t){return t+e.increment})),s=i[1]>n?i[0]-r:0;this.props.onChange(i.map((function(e){return e-s})))}},r.stepBackward=function(){var e=this,t=this.props,r=t.start,n=t.end,a=t.step,o=t.values;if(!t.disabled){var i=(Array.isArray(o)?o:[o,o+a]).map((function(t){return t-e.increment})),s=i[0]<r?n-i[1]:0;this.props.onChange(i.map((function(e){return e+s})))}},r.formatter=function(e){if(this.props.disabled)return Object(u.b)("Data has no time steps");var t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map((function(e){return new Date(e).toUTCString()})).join(" : ")},r.render=function(){var e=this.props,t=e.start,r=e.end,n=e.step,o=e.orientation,i=e.reversed,s=e.disabled,l=e.range,c=e.values;return a.a.createElement("div",{className:"play-slider"},a.a.createElement("div",{className:"play-slider-controls padded"},a.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),a.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),a.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),a.a.createElement("div",{className:"play-slider-scrobbler padded"},a.a.createElement(f,{value:l?c:c[0],range:l,formatter:this.formatter,change:this.onChange,min:t,max:r,step:n,orientation:o,reversed:i,disabled:s?"disabled":"enabled"})))},t}(a.a.PureComponent);function b(){return(b=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}m.propTypes=g,m.defaultProps={onChange:function(){},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0},r.d(t,"a",(function(){return y}));var v={getLayers:i.a.func.isRequired,start:i.a.number.isRequired,end:i.a.number.isRequired,getStep:i.a.func,values:i.a.array.isRequired,aggregation:i.a.bool,disabled:i.a.bool,viewport:i.a.object.isRequired,children:i.a.node,mapStyle:i.a.string,mapboxApiAccessToken:i.a.string.isRequired,setControlValue:i.a.func,onViewportChange:i.a.func,onValuesChange:i.a.func},y=function(e){function t(t){var r;return(r=e.call(this,t)||this).onViewportChange=r.onViewportChange.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var r=t.prototype;return r.onViewportChange=function(e){var t=this.props.disabled?b({},e):b({},e,{height:e.height+20});this.props.onViewportChange(t)},r.render=function(){var e=this.props,t=e.start,r=e.end,n=e.getStep,o=e.disabled,i=e.aggregation,l=e.children,c=e.getLayers,u=e.values,p=e.onValuesChange,d=e.viewport,f=e.setControlValue,h=e.mapStyle,g=e.mapboxApiAccessToken,v=c(u),y=b({},d,{height:o?d.height:d.height-20});return a.a.createElement("div",null,a.a.createElement(s.a,{viewport:y,layers:v,setControlValue:f,mapStyle:h,mapboxApiAccessToken:g,onViewportChange:this.onViewportChange}),!o&&a.a.createElement(m,{start:t,end:r,step:n(t),values:u,range:!i,onChange:p}),l)},t}(a.a.Component);y.propTypes=v,y.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:function(){},onViewportChange:function(){},onValuesChange:function(){}}},736:function(e,t,r){var n=r(737);"string"==typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r(334)(n,a);n.locals&&(e.exports=n.locals)},737:function(e,t,r){(e.exports=r(333)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n .deckgl-tooltip > div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n',""])},760:function(e,t){},762:function(e,t){},763:function(e,t){},787:function(e,t,r){var n=r(788);"string"==typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r(334)(n,a);n.locals&&(e.exports=n.locals)},788:function(e,t,r){(e.exports=r(333)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n.BootstrapSliderWrapper .slider-selection {\n    background: #efefef;\n}\n\n.BootstrapSliderWrapper .slider-handle {\n    background: #b3b3b3;\n}\n\n',""])},789:function(e,t,r){var n=r(790);"string"==typeof n&&(n=[[e.i,n,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};r(334)(n,a);n.locals&&(e.exports=n.locals)},790:function(e,t,r){(e.exports=r(333)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n.play-slider {\n    display: flex;\n    height: 40px;\n    width: 100%;\n    margin: 0;\n}\n\n.play-slider-controls {\n    flex: 0 0 80px;\n    text-align: middle;\n}\n\n.play-slider-scrobbler {\n    flex: 1 1;\n}\n\n.slider.slider-horizontal {\n    width: 100% !important;\n}\n\n.slider-button {\n    color: #b3b3b3;\n    margin-right: 5px;\n}\n\ndiv.slider > div.tooltip.tooltip-main.top.in {\n    margin-left: 0 !important;\n}\n',""])},794:function(e,t,r){"use strict";r.r(t),r.d(t,"getLayer",(function(){return p}));var n=r(699),a=r(0),o=r.n(a),i=r(679),s=r(688),l=r(703),c=r(700);function u(){return(u=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}function p(e,t,r,a){var l=t.data.features,p=e.color_picker,d=e.target_color_picker;return new n.a(u({data:l,getSourceColor:function(e){return e.sourceColor||e.color||[p.r,p.g,p.b,255*p.a]},getTargetColor:function(e){return e.targetColor||e.color||[d.r,d.g,d.b,255*d.a]},id:"path-layer-"+e.slice_id,strokeWidth:e.stroke_width?e.stroke_width:3},Object(s.a)(e,a,function(e){return function(t){return o.a.createElement("div",{className:"deckgl-tooltip"},o.a.createElement(c.a,{label:Object(i.b)("Start (Longitude, Latitude)")+": ",value:t.object.sourcePosition[0]+", "+t.object.sourcePosition[1]}),o.a.createElement(c.a,{label:Object(i.b)("End (Longitude, Latitude)")+": ",value:t.object.targetPosition[0]+", "+t.object.targetPosition[1]}),e.dimension&&o.a.createElement(c.a,{label:e.dimension+": ",value:""+t.object.cat_color}))}}(e))))}t.default=Object(l.a)(p,(function(e){var t=[];return e.forEach((function(e){t.push(e.sourcePosition),t.push(e.targetPosition)})),t}))},836:function(e,t,r){"use strict";r.r(t),r.d(t,"getLayer",(function(){return y}));var n=r(0),a=r.n(n),o=r(2),i=r.n(o),s=r(699),l=r(705),c=r(702),u=r(693),p=r(688),d=r(700);function f(){return(f=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}var h,g={fillColor:"fillColor",color:"fillColor",fill:"fillColor","fill-color":"fillColor",strokeColor:"strokeColor","stroke-color":"strokeColor","stroke-width":"strokeWidth"},m=function(e,t){var r={};return Object.keys(e).forEach((function(t){t in g?r[g[t]]=e[t]:r[t]=e[t]})),"string"==typeof e.fillColor&&(r.fillColor=Object(c.hexToRGB)(e.fillColor)),"string"==typeof e.strokeColor&&(r.strokeColor=Object(c.hexToRGB)(e.strokeColor)),f({},r,{},t)},b=function(e,t,r){if(e&&e.features&&e.features.forEach((function(n){b(n,t,e.extraProps||r)})),e&&e.geometry){var n=f({},e,{properties:m(e.properties,t)});n.extraProps||(n.extraProps=r),h.push(n)}};function v(e){return e.object.extraProps&&a.a.createElement("div",{className:"deckgl-tooltip"},Object.keys(e.object.extraProps).map((function(t,r){return a.a.createElement(d.a,{key:"prop-"+r,label:t+": ",value:""+e.object.extraProps[t]})})))}function y(e,t,r,n){var a,o=e,i=o.fill_color_picker,l=o.stroke_color_picker,c=[i.r,i.g,i.b,255*i.a],d=[l.r,l.g,l.b,255*l.a],g={};return 0<c[3]&&(g.fillColor=c),0<d[3]&&(g.strokeColor=d),h=[],b(t.data,g),o.js_data_mutator&&(a=Object(u.a)(o.js_data_mutator),h=a(h)),new s.b(f({id:"geojson-layer-"+o.slice_id,filled:o.filled,data:h,stroked:o.stroked,extruded:o.extruded,pointRadiusScale:o.point_radius_scale},Object(p.a)(o,n,v)))}var _={formData:i.a.object.isRequired,payload:i.a.object.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,onAddFilter:i.a.func,setTooltip:i.a.func};function w(e){var t=e.formData,r=e.payload,n=e.setControlValue,o=(e.onAddFilter,e.setTooltip),i=e.viewport,s=y(t,r,0,o);return a.a.createElement(l.a,{mapboxApiAccessToken:r.data.mapboxApiKey,viewport:i,layers:[s],mapStyle:t.mapbox_style,setControlValue:n})}w.propTypes=_,w.defaultProps={onAddFilter:function(){},setTooltip:function(){}},t.default=w},837:function(e,t,r){"use strict";r.r(t),r.d(t,"getLayer",(function(){return f}));var n=r(699),a=r(0),o=r.n(a),i=r(679),s=r(688),l=r(693),c=r(703),u=r(700);function p(){return(p=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}function d(e){return o.a.createElement("div",{className:"deckgl-tooltip"},o.a.createElement(u.a,{label:Object(i.b)("Longitude and Latitude")+": ",value:e.object.position[0]+", "+e.object.position[1]}),o.a.createElement(u.a,{label:Object(i.b)("Height")+": ",value:""+e.object.elevationValue}))}function f(e,t,r,a){var o=e,i=o.color_picker,c=t.data.features.map((function(e){return p({},e,{color:[i.r,i.g,i.b,255*i.a]})}));o.js_data_mutator&&(c=Object(l.a)(o.js_data_mutator)(c));var u=Object(s.c)(o.js_agg_function,(function(e){return e.weight}));return new n.c(p({id:"grid-layer-"+o.slice_id,data:c,pickable:!0,cellSize:o.grid_size,minColor:[0,0,0,0],extruded:o.extruded,maxColor:[i.r,i.g,i.b,255*i.a],outline:!1,getElevationValue:u,getColorValue:u},Object(s.a)(o,a,d)))}t.default=Object(c.b)(f,(function(e){return e.map((function(e){return e.position}))}))},838:function(e,t,r){"use strict";r.r(t),r.d(t,"getLayer",(function(){return f}));var n=r(699),a=r(0),o=r.n(a),i=r(679),s=r(688),l=r(693),c=r(703),u=r(700);function p(){return(p=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}function d(e){return o.a.createElement("div",{className:"deckgl-tooltip"},o.a.createElement(u.a,{label:Object(i.b)("Centroid (Longitude and Latitude)")+": ",value:"("+e.object.centroid[0]+", "+e.object.centroid[1]+")"}),o.a.createElement(u.a,{label:Object(i.b)("Height")+": ",value:""+e.object.elevationValue}))}function f(e,t,r,a){var o=e,i=o.color_picker,c=t.data.features.map((function(e){return p({},e,{color:[i.r,i.g,i.b,255*i.a]})}));o.js_data_mutator&&(c=Object(l.a)(o.js_data_mutator)(c));var u=Object(s.c)(o.js_agg_function,(function(e){return e.weight}));return new n.d(p({id:"hex-layer-"+o.slice_id,data:c,pickable:!0,radius:o.grid_size,minColor:[0,0,0,0],extruded:o.extruded,maxColor:[i.r,i.g,i.b,255*i.a],outline:!1,getElevationValue:u,getColorValue:u},Object(s.a)(o,a,d)))}t.default=Object(c.b)(f,(function(e){return e.map((function(e){return e.position}))}))},842:function(e,t,r){"use strict";r.r(t),r.d(t,"getLayer",(function(){return b}));var n=r(0),a=r.n(n),o=r(2),i=r.n(o),s=r(699),l=r(679),c=r(712),u=r(711),p=r(693),d=r(688),f=r(700);function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(){return(g=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}function m(e){return a.a.createElement("div",{className:"deckgl-tooltip"},a.a.createElement(f.a,{label:Object(l.b)("Longitude and Latitude")+": ",value:e.object.position[0]+", "+e.object.position[1]}),a.a.createElement(f.a,{label:Object(l.b)("Weight")+": ",value:""+e.object.weight}))}function b(e,t,r,n,a,o,i){var l=e,c=l.color_picker,u=t.data.features.map((function(e){return g({},e,{color:[c.r,c.g,c.b,255*c.a]})}));if(l.js_data_mutator){var f=Object(p.a)(l.js_data_mutator);u=f(u)}return null!=i&&i.forEach((function(e){u=u.filter(e)})),new s.h(g({id:"screengrid-layer-"+l.slice_id,data:u,pickable:!0,cellSizePixels:l.grid_size,minColor:[c.r,c.g,c.b,0],maxColor:[c.r,c.g,c.b,255*c.a],outline:!1,getWeight:function(e){return e.weight||0}},Object(d.a)(l,n,m)))}var v={formData:i.a.object.isRequired,payload:i.a.object.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,onAddFilter:i.a.func,setTooltip:i.a.func},y=function(e){function t(r){var n;return(n=e.call(this,r)||this).state=t.getDerivedStateFromProps(r),n.getLayers=n.getLayers.bind(h(n)),n.onValuesChange=n.onValuesChange.bind(h(n)),n.onViewportChange=n.onViewportChange.bind(h(n)),n}(function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t})(t,e),t.getDerivedStateFromProps=function(e,t){if(t&&e.payload.form_data===t.formData)return null;var r=e.payload.data.features||[],n=r.map((function(e){return e.__timestamp})),a=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",o=Object(u.a)(n,a);return{start:o.start,end:o.end,getStep:o.getStep,values:o.values,disabled:o.disabled,viewport:e.formData.autozoom?Object(d.b)(e.viewport,function(e){return e.map((function(e){return e.position}))}(r)):e.viewport,selected:[],lastClick:0,formData:e.payload.form_data}};var r=t.prototype;return r.onValuesChange=function(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})},r.onViewportChange=function(e){this.setState({viewport:e})},r.getLayers=function(e){var t=[];return e[0]===e[1]||e[1]===this.end?t.push((function(t){return t.__timestamp>=e[0]&&t.__timestamp<=e[1]})):t.push((function(t){return t.__timestamp>=e[0]&&t.__timestamp<e[1]})),[b(this.props.formData,this.props.payload,this.props.onAddFilter,this.props.setTooltip)]},r.render=function(){var e=this.props,t=e.formData,r=e.payload,n=e.setControlValue;return a.a.createElement("div",null,a.a.createElement(c.a,{getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,onValuesChange:this.onValuesChange,disabled:this.state.disabled,viewport:this.state.viewport,onViewportChange:this.onViewportChange,mapboxApiAccessToken:r.data.mapboxApiKey,mapStyle:t.mapbox_style,setControlValue:n,aggregation:!0}))},t}(a.a.PureComponent);y.propTypes=v,y.defaultProps={onAddFilter:function(){},setTooltip:function(){}},t.default=y},843:function(e,t,r){"use strict";r.r(t),r.d(t,"getLayer",(function(){return d}));var n=r(699),a=r(0),o=r.n(a),i=r(688),s=r(693),l=r(703),c=r(700);function u(){return(u=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}function p(e){return e.object.extraProps&&o.a.createElement("div",{className:"deckgl-tooltip"},Object.keys(e.object.extraProps).map((function(t,r){return o.a.createElement(c.a,{key:"prop-"+r,label:t+": ",value:""+e.object.extraProps[t]})})))}function d(e,t,r,a){var o=e,l=o.color_picker,c=[l.r,l.g,l.b,255*l.a],d=t.data.features.map((function(e){return u({},e,{path:e.path,width:o.line_width,color:c})}));o.js_data_mutator&&(d=Object(s.a)(o.js_data_mutator)(d));return new n.e(u({id:"path-layer-"+o.slice_id,data:d,rounded:!0,widthScale:1},Object(i.a)(o,a,p)))}t.default=Object(l.b)(d,(function(e){var t=[];return e.forEach((function(e){t=t.concat(e.path)})),t}))},846:function(e,t,r){"use strict";r.r(t);var n=r(699),a=r(0),o=r.n(a),i=r(679),s=r(688),l=r(703),c=r(700);var u=1609.34;function p(){return(p=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}function d(e,t,r,a){var l=e,d=t.data.features.map((function(e){var t=function(e,t){return"square_m"===e?Math.sqrt(t/Math.PI):"radius_m"===e?t:"radius_km"===e?1e3*t:"radius_miles"===e?t*u:"square_km"===e?1e3*Math.sqrt(t/Math.PI):"square_miles"===e?Math.sqrt(t/Math.PI)*u:null}(l.point_unit,e.radius)||10;if(l.multiplier&&(t*=l.multiplier),e.color)return p({},e,{radius:t});var r=l.color_picker||{r:0,g:0,b:0,a:1};return p({},e,{radius:t,color:[r.r,r.g,r.b,255*r.a]})}));return new n.g(p({id:"scatter-layer-"+l.slice_id,data:d,fp64:!0,radiusMinPixels:l.min_radius||null,radiusMaxPixels:l.max_radius||null,outline:!1},Object(s.a)(l,a,function(e){return function(t){return o.a.createElement("div",{className:"deckgl-tooltip"},o.a.createElement(c.a,{label:Object(i.b)("Longitude and Latitude")+": ",value:t.object.position[0]+", "+t.object.position[1]}),t.object.cat_color&&o.a.createElement(c.a,{label:Object(i.b)("Category")+": ",value:""+t.object.cat_color}),t.object.metric&&o.a.createElement(c.a,{label:e.point_radius_fixed.value.label+": ",value:""+t.object.metric}))}}(l))))}r.d(t,"getLayer",(function(){return d}));t.default=Object(l.a)(d,(function(e){return e.map((function(e){return e.position}))}))},847:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(2),i=r.n(o),s=r(699),l=r(712),c=r(704),u=r(700),p=r(701),d=r(844),f=r(98),h=r(335),g=r(702),m=10;function b(e,t,r){var n=e.break_points,a=e.num_buckets;if(!t)return[];if(void 0===n||0===n.length){var o=a?parseInt(a,10):m,i=Object(p.extent)(t,r),s=i[0],l=i[1];if(void 0===s)return[];var c=(l-s)/o,u=0===c?0:Math.max(0,Math.ceil(Math.log10(1/c))),d=l>l.toFixed(u)?1:0;return Array(o+1+d).fill().map((function(e,t){return(s+t*c).toFixed(u)}))}return n.sort((function(e,t){return parseFloat(e)-parseFloat(t)}))}function v(e,t,r){var n,a,o=e.break_points,i=e.num_buckets,s=e.linear_color_scheme,l=e.opacity,c=o||i?b({break_points:o,num_buckets:i},t,r):null,u=Array.isArray(s)?new f.a({colors:s,id:"custom"}):Object(h.a)().get(s);if(null!==c){var m=c.length-1,v=1<m?u.getColors(m):[u.colors[u.colors.length-1]],y=v[0],_=v[v.length-1];v.unshift(y),v.push(_);var w=c.map((function(e){return parseFloat(e)}));n=Object(d.a)().domain(w).range(v),a=function(e){return e>c[m]||e<c[0]}}else n=u.createLinearScale(Object(p.extent)(t,r)),a=function(){return!1};return function(e){var t=r(e),o=Object(g.hexToRGB)(n(t));return o[3]=a(t)?0:l/100*255,o}}var y=r(688),_=r(711),w=r(693);function C(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function j(){return(j=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}r.d(t,"getLayer",(function(){return O}));function O(e,t,r,n,o,i,l){var c=e,p=c.fill_color_picker,d=c.stroke_color_picker,f=[].concat(t.data.features);if(null!=l&&l.forEach((function(e){f=f.filter(e)})),c.js_data_mutator){var h=Object(w.a)(c.js_data_mutator);f=h(f)}var g=c.metric?c.metric.label||c.metric:null,m=null===c.metric?function(){return[p.r,p.g,p.b,255*p.a]}:v(c,f,(function(e){return e[g]})),b=function(e){var t=m(e);return 0<o.length&&-1===o.indexOf(e[c.line_column])&&(t[3]/=2),t},_=c.line_column&&c.metric&&0<=["geohash","zipcode"].indexOf(c.line_type)?function(e){return function(t){var r=e.metric.label||e.metric;return a.a.createElement("div",{className:"deckgl-tooltip"},a.a.createElement(u.a,{label:e.line_column+": ",value:""+t.object[e.line_column]}),e.metric&&a.a.createElement(u.a,{label:r+": ",value:""+t.object[r]}))}}(c):void 0;return new s.f(j({id:"path-layer-"+c.slice_id,data:f,pickable:!0,filled:c.filled,stroked:c.stroked,getPolygon:function(e){return e.polygon},getFillColor:b,getLineColor:[d.r,d.g,d.b,255*d.a],getLineWidth:c.line_width,extruded:c.extruded,getElevation:function(e){return function(e,t){return 0===t(e)[3]?0:e.elevation}(e,b)},elevationScale:c.multiplier,fp64:!0},Object(y.a)(c,n,_,i)))}var S={formData:i.a.object.isRequired,payload:i.a.object.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,onAddFilter:i.a.func,setTooltip:i.a.func},A=function(e){function t(r){var n;return(n=e.call(this,r)||this).state=t.getDerivedStateFromProps(r),n.getLayers=n.getLayers.bind(C(n)),n.onSelect=n.onSelect.bind(C(n)),n.onValuesChange=n.onValuesChange.bind(C(n)),n.onViewportChange=n.onViewportChange.bind(C(n)),n}(function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t})(t,e),t.getDerivedStateFromProps=function(e,t){if(t&&e.payload.form_data===t.formData)return null;var r=e.payload.data.features||[],n=r.map((function(e){return e.__timestamp})),a=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",o=Object(_.a)(n,a);return{start:o.start,end:o.end,getStep:o.getStep,values:o.values,disabled:o.disabled,viewport:e.formData.autozoom?Object(y.b)(e.viewport,function(e){return e.map((function(e){return e.polygon})).flat()}(r)):e.viewport,selected:[],lastClick:0,formData:e.payload.form_data}};var r=t.prototype;return r.onSelect=function(e){var t=this.props,r=t.formData,n=t.onAddFilter,a=new Date,o=a-this.state.lastClick<=250,i=[].concat(this.state.selected);if(o)i.splice(0,i.length,e);else if(r.toggle_polygons){var s=i.indexOf(e);-1===s?i.push(e):i.splice(s,1)}else i.splice(0,1,e);this.setState({selected:i,lastClick:a}),r.table_filter&&n(r.line_column,i,!1,!0)},r.onValuesChange=function(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})},r.onViewportChange=function(e){this.setState({viewport:e})},r.getLayers=function(e){if(void 0===this.props.payload.data.features)return[];var t=[];return e[0]===e[1]||e[1]===this.end?t.push((function(t){return t.__timestamp>=e[0]&&t.__timestamp<=e[1]})):t.push((function(t){return t.__timestamp>=e[0]&&t.__timestamp<e[1]})),[O(this.props.formData,this.props.payload,this.props.onAddFilter,this.props.setTooltip,this.state.selected,this.onSelect,t)]},r.render=function(){var e=this.props,t=e.payload,r=e.formData,n=e.setControlValue,o=this.state,i=o.start,s=o.end,u=o.getStep,p=o.values,d=o.disabled,f=o.viewport,h=r,g=h.metric?h.metric.label||h.metric:null,m=function(e,t,r){var n=b(e,t,r),a=v(e,t,r),o={};return n.slice(1).forEach((function(t,r){var i,s=n[r]+" - "+n[r+1],l=.5*(parseFloat(n[r])+parseFloat(n[r+1])),c=e.metric?e.metric.label||e.metric:null;o[s]={color:a((i={},i[c||e.metric]=l,i)),enabled:!0}})),o}(r,t.data.features,(function(e){return e[g]}));return a.a.createElement("div",{style:{position:"relative"}},a.a.createElement(l.a,{getLayers:this.getLayers,start:i,end:s,getStep:u,values:p,onValuesChange:this.onValuesChange,disabled:d,viewport:f,onViewportChange:this.onViewportChange,mapboxApiAccessToken:t.data.mapboxApiKey,mapStyle:r.mapbox_style,setControlValue:n,aggregation:!0},null!==r.metric&&a.a.createElement(c.a,{categories:m,position:r.legend_position,format:r.legend_format})))},t}(a.a.Component);A.propTypes=S,A.defaultProps={onAddFilter:function(){},setTooltip:function(){}};t.default=A},998:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(713),i=r.n(o),s=r(2),l=r.n(s),c=r(997),u=r(705),p=r(994),d=r.n(p);var f=8e3;function h(e,t,r,n){if(void 0===r&&(r=!0),void 0===n&&(n={}),!e.datasource)return null;var a=new d.a("/"),o=function(e,t){void 0===t&&(t="base");var r="/superset/explore/";return 0<=["json","csv","query","results","samples"].indexOf(t)&&(r="/superset/explore_json/"),r}(0,t),i=a.search(!0);Object.keys(n).forEach((function(e){i[e]=n[e]})),i.form_data=function(e){var t=new Set;return JSON.stringify(e,(function(e,r){if("object"==typeof r&&null!==r){if(t.has(r))try{return JSON.parse(JSON.stringify(r))}catch(e){return}t.add(r)}return r}))}(e),"standalone"===t&&(i.standalone="true");var s=a.directory(o).search(i).toString();return!r&&s.length>f?h({datasource:e.datasource,viz_type:e.viz_type},t,!1,{URL_IS_TOO_LONG_TO_SHARE:null}):s}var g=r(837),m=r(842),b=r(843),v=r(838),y=r(846),_=r(836),w=r(794),C=r(847),j={deck_grid:g.getLayer,deck_screengrid:m.getLayer,deck_path:b.getLayer,deck_hex:v.getLayer,deck_scatter:y.getLayer,deck_geojson:_.getLayer,deck_arc:w.getLayer,deck_polygon:C.getLayer};function O(){return(O=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)}var S={formData:l.a.object.isRequired,payload:l.a.object.isRequired,setControlValue:l.a.func.isRequired,viewport:l.a.object.isRequired,onAddFilter:l.a.func,setTooltip:l.a.func,onSelect:l.a.func},A=function(e){function t(t){var r;return(r=e.call(this,t)||this).state={subSlicesLayers:{}},r.onViewportChange=r.onViewportChange.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var r=t.prototype;return r.componentDidMount=function(){var e=this.props,t=e.formData,r=e.payload;this.loadLayers(t,r)},r.UNSAFE_componentWillReceiveProps=function(e){var t=e.formData,r=e.payload;!i.a.isEqual(this.props.formData.deck_slices,e.formData.deck_slices)&&this.loadLayers(t,r)},r.onViewportChange=function(e){this.setState({viewport:e})},r.loadLayers=function(e,t,r){var n=this;this.setState({subSlicesLayers:{},viewport:r}),t.data.slices.forEach((function(t){var r=[].concat(t.form_data.filters||[],e.filters||[],e.extra_filters||[]),a=O({},t,{form_data:O({},t.form_data,{filters:r})});c.a.get({endpoint:h(a.form_data,"json")}).then((function(e){var t,r=e.json,o=j[a.form_data.viz_type](a.form_data,r,n.props.onAddFilter,n.props.setTooltip,[],n.props.onSelect);n.setState({subSlicesLayers:O({},n.state.subSlicesLayers,(t={},t[a.slice_id]=o,t))})})).catch((function(){}))}))},r.render=function(){var e=this.props,t=e.payload,r=e.formData,n=e.setControlValue,o=this.state.subSlicesLayers,i=Object.values(o);return a.a.createElement(u.a,{mapboxApiAccessToken:t.data.mapboxApiKey,viewport:this.state.viewport||this.props.viewport,onViewportChange:this.onViewportChange,layers:i,mapStyle:r.mapbox_style,setControlValue:n})},t}(a.a.PureComponent);A.propTypes=S,A.defaultProps={onAddFilter:function(){},setTooltip:function(){},onSelect:function(){}};t.default=A}}]);