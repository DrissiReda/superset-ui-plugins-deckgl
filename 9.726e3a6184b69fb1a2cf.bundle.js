(window.webpackJsonp=window.webpackJsonp||[]).push([[9,3],{718:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return h})),n.d(t,"c",(function(){return d}));var i=n(944),a=n(717),r=n(719);function o(){return(o=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}var s=.25,l={LAT_MAX:90,LAT_MIN:-90,LNG_MAX:180,LNG_MIN:-180};function u(e){var t=a.extent(e,(function(e){return e[1]})),n=a.extent(e,(function(e){return e[0]})),i=t[0]===t[1]?function(e){return[e[0]-s<l.LAT_MIN?l.LAT_MIN:e[0]-s,e[1]+s>l.LAT_MAX?l.LAT_MAX:e[1]+s]}(t):t,r=n[0]===n[1]?function(e){return[e[0]-s<l.LNG_MIN?l.LNG_MIN:e[0]-s,e[1]+s>l.LNG_MAX?l.LNG_MAX:e[1]+s]}(n):n;return[[r[0],i[0]],[r[1],i[1]]]}function c(e,t,n){void 0===n&&(n=10);try{var a=u(t);return o({},e,{},Object(i.a)({bounds:a,height:e.height,padding:n,width:e.width}))}catch(t){return console.error("Could not auto zoom",t),e}}function h(e,t,n,i){var a,o,s=e,l=n;return s.js_tooltip&&(l=Object(r.a)(s.js_tooltip)),l&&(a=function(e){e.picked?t({content:l(e),x:e.x,y:e.y}):t(null)}),s.js_onclick_href?o=function(e){var t=Object(r.a)(s.js_onclick_href)(e);window.open(t)}:s.table_filter&&void 0!==i&&(o=function(e){return i(e.object[s.line_column])}),{onClick:o,onHover:a,pickable:!!a}}var g={p1:.01,p5:.05,p95:.95,p99:.99};function d(e,t){return void 0===e&&(e="sum"),void 0===t&&(t=null),"count"===e?function(e){return e.length}:(n=e in g?function(n,i){var r;return r=t?n.sort((function(e,n){return a.ascending(t(e),t(n))})):n.sort(a.ascending),a.quantile(r,g[e],i)}:a[e],t?function(e){return n(e.map(t))}:function(e){return n(e)});var n}},719:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var i=n(772),a=n.n(i),r=n(773),o=n.n(r),s=n(717),l=n(723);function u(){return(u=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}var c={console:console,_:o.a,colors:l,d3array:s};function h(e,t,n){var i={},r="SAFE_EVAL_"+Math.floor(1e6*Math.random());i[r]={};var o=u({},c,{},t);Object.keys(o).forEach((function(e){i[e]=o[e]}));try{return a.a.runInNewContext(r+"="+e,i,n),i[r]}catch(e){return function(){return e}}}},723:function(e,t,n){"use strict";n.r(t),n.d(t,"hexToRGB",(function(){return a}));var i=n(26);function a(e,t){if(void 0===t&&(t=255),!e)return[0,0,0,t];var n=Object(i.g)(e);return[n.r,n.g,n.b,t]}},724:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(0),a=n.n(i),r=n(1),o=n.n(r);var s={label:o.a.string.isRequired,value:o.a.string.isRequired},l=function(e){function t(){return e.apply(this,arguments)||this}return function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e),t.prototype.render=function(){var e=this.props,t=e.label,n=e.value;return a.a.createElement("div",null,t,a.a.createElement("strong",null,n))},t}(a.a.PureComponent);l.propTypes=s},727:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var i=n(0),a=n.n(i),r=n(1),o=n.n(r),s=n(783),l=n(1073);n(774),n(741);function u(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var c=250,h={viewport:o.a.object.isRequired,layers:o.a.array.isRequired,setControlValue:o.a.func,mapStyle:o.a.string,mapboxApiAccessToken:o.a.string.isRequired,children:o.a.node,bottomMargin:o.a.number,width:o.a.number.isRequired,height:o.a.number.isRequired},g=function(e){function t(t){var n;return(n=e.call(this,t)||this).tick=n.tick.bind(u(n)),n.onViewStateChange=n.onViewStateChange.bind(u(n)),n.state={timer:setInterval(n.tick,c),viewState:t.viewport},n}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var n=t.prototype;return n.componentWillUnmount=function(){clearInterval(this.state.timer)},n.onViewStateChange=function(e){var t=e.viewState;this.setState({viewState:t,lastUpdate:Date.now()})},n.tick=function(){var e=this.state.lastUpdate;if(e&&Date.now()-e>c){var t=this.props.setControlValue;t&&t("viewport",this.state.viewState),this.setState({lastUpdate:null})}},n.layers=function(){return this.props.layers.some((function(e){return"function"==typeof e}))?this.props.layers.map((function(e){return"function"==typeof e?e():e})):this.props.layers},n.render=function(){var e=this.props,t=e.children,n=e.bottomMargin,i=e.height,r=e.width,o=this.state.viewState,u=i-n,c=this.layers();return a.a.createElement("div",{style:{position:"relative",width:r,height:u}},a.a.createElement(l.a,{width:r,height:u,layers:c,viewState:o,onViewStateChange:this.onViewStateChange,initWebGLParameters:!0,controller:!0},a.a.createElement(s.a,{mapStyle:this.props.mapStyle,mapboxApiAccessToken:this.props.mapboxApiAccessToken})),t)},t}(a.a.Component);g.propTypes=h,g.defaultProps={mapStyle:"light",setControlValue:function(){},children:null,bottomMargin:0}},732:function(e,t,n){"use strict";var i=n(0),a=n.n(i),r=n(1),o=n.n(r),s=n(763),l=n(727),u=n(691),c=n(736),h=n(733),g=n(723),d=n(734),p=n(719),f=n(718);function v(){return(v=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var y=u.a.getScale;var b={formData:o.a.object.isRequired,mapboxApiKey:o.a.string.isRequired,setControlValue:o.a.func.isRequired,viewport:o.a.object.isRequired,getLayer:o.a.func.isRequired,getPoints:o.a.func.isRequired,payload:o.a.object.isRequired,onAddFilter:o.a.func,setTooltip:o.a.func,width:o.a.number.isRequired,height:o.a.number.isRequired},O=function(e){function t(t){var n;return(n=e.call(this,t)||this).state=n.getStateFromProps(t),n.getLayers=n.getLayers.bind(m(n)),n.onValuesChange=n.onValuesChange.bind(m(n)),n.toggleCategory=n.toggleCategory.bind(m(n)),n.showSingleCategory=n.showSingleCategory.bind(m(n)),n}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var n=t.prototype;return n.UNSAFE_componentWillReceiveProps=function(e){e.payload.form_data!==this.state.formData&&this.setState(v({},this.getStateFromProps(e)))},n.onValuesChange=function(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})},n.getStateFromProps=function(e,t){var n=e.payload.data.features||[],i=n.map((function(e){return e.__timestamp})),a=function(e,t){var n=e.color_picker||{r:0,g:0,b:0,a:1},i=[n.r,n.g,n.b,255*n.a],a=y(e.color_scheme),r={};return t.forEach((function(t){var o;null==t.cat_color||r.hasOwnProperty(t.cat_color)||(o=e.dimension?Object(g.hexToRGB)(a(t.cat_color),255*n.a):i,r[t.cat_color]={color:o,enabled:!0})})),r}(e.formData,n);if(t&&e.payload.form_data===t.formData)return v({},t,{categories:a});var r=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",o=Object(d.a)(i,r);return{start:o.start,end:o.end,getStep:o.getStep,values:o.values,disabled:o.disabled,viewport:e.formData.autozoom?Object(f.b)(e.viewport,e.getPoints(n)):e.viewport,selected:[],lastClick:0,formData:e.payload.form_data,categories:a}},n.getLayers=function(e){var t=this.props,n=t.getLayer,i=t.payload,a=t.formData,r=t.onAddFilter,o=t.setTooltip,s=i.data.features?[].concat(i.data.features):[];(s=this.addColor(s,a),a.js_data_mutator)&&(s=Object(p.a)(a.js_data_mutator)(s));s=e[0]===e[1]||e[1]===this.end?s.filter((function(t){return t.__timestamp>=e[0]&&t.__timestamp<=e[1]})):s.filter((function(t){return t.__timestamp>=e[0]&&t.__timestamp<e[1]}));var l=this.state.categories;return a.dimension&&(s=s.filter((function(e){return l[e.cat_color]&&l[e.cat_color].enabled}))),[n(a,v({},i,{data:v({},i.data,{features:s})}),r,o)]},n.addColor=function(e,t){var n=t.color_picker||{r:0,g:0,b:0,a:1},i=y(t.color_scheme);return e.map((function(e){return t.dimension?v({},e,{color:Object(g.hexToRGB)(i(e.cat_color),255*n.a)}):e}))},n.toggleCategory=function(e){var t,n=this.state.categories[e],i=v({},this.state.categories,((t={})[e]=v({},n,{enabled:!n.enabled}),t));Object.values(i).every((function(e){return!e.enabled}))&&Object.values(i).forEach((function(e){e.enabled=!0})),this.setState({categories:i})},n.showSingleCategory=function(e){var t=v({},this.state.categories);Object.values(t).forEach((function(e){e.enabled=!1})),t[e].enabled=!0,this.setState({categories:t})},n.render=function(){return a.a.createElement("div",{style:{position:"relative"}},a.a.createElement(c.a,{getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,onValuesChange:this.onValuesChange,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},a.a.createElement(h.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))},t}(a.a.PureComponent);function S(){return(S=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}O.propTypes=b,n.d(t,"b",(function(){return x})),n.d(t,"a",(function(){return k}));var C={formData:o.a.object.isRequired,payload:o.a.object.isRequired,setControlValue:o.a.func.isRequired,viewport:o.a.object.isRequired,onAddFilter:o.a.func,setTooltip:o.a.func,width:o.a.number.isRequired,height:o.a.number.isRequired},w={onAddFilter:function(){},setTooltip:function(){}};function x(e,t){var n=function(n){function i(e){var i=n.call(this,e)||this,a=e.viewport,r=e.formData.autozoom?Object(f.b)(a,t(e.payload.data.features)):a;return i.state={viewport:r,layer:i.computeLayer(e)},i.onViewportChange=i.onViewportChange.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(i)),i}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(i,n);var r=i.prototype;return r.UNSAFE_componentWillReceiveProps=function(e){var t=S({},e.formData,{viewport:null}),n=S({},this.props.formData,{viewport:null});Object(s.isEqual)(t,n)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})},r.onViewportChange=function(e){this.setState({viewport:e})},r.computeLayer=function(t){var n=t.formData,i=t.payload,a=t.onAddFilter,r=t.setTooltip;return e(n,i,a,r)},r.render=function(){var e=this.props,t=e.formData,n=e.payload,i=e.setControlValue,r=e.height,o=e.width,s=this.state,u=s.layer,c=s.viewport;return a.a.createElement(l.a,{mapboxApiAccessToken:n.data.mapboxApiKey,viewport:c,layers:[u],mapStyle:t.mapbox_style,setControlValue:i,onViewportChange:this.onViewportChange,width:o,height:r})},i}(a.a.PureComponent);return n.propTypes=C,n.defaultProps=w,n}function k(e,t){function n(n){var i=n.formData,r=n.payload,o=n.setControlValue,s=n.onAddFilter,l=n.setTooltip,u=n.viewport,c=n.width,h=n.height;return a.a.createElement(O,{formData:i,mapboxApiKey:r.data.mapboxApiKey,setControlValue:o,viewport:u,getLayer:e,payload:r,onAddFilter:s,setTooltip:l,getPoints:t,width:c,height:h})}return n.propTypes=C,n.defaultProps=w,n}},733:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var i=n(0),a=n.n(i),r=n(1),o=n.n(r),s=n(1045);n(737);var l={categories:o.a.object,toggleCategory:o.a.func,showSingleCategory:o.a.func,format:o.a.string,position:o.a.oneOf([null,"tl","tr","bl","br"])},u=function(e){function t(){return e.apply(this,arguments)||this}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var n=t.prototype;return n.format=function(e){if(!this.props.format)return e;var t=parseFloat(e);return Object(s.a)(this.props.format,t)},n.formatCategoryLabel=function(e){if(!this.props.format)return e;if(e.includes(" - ")){var t=e.split(" - ");return this.format(t[0])+" - "+this.format(t[1])}return this.format(e)},n.render=function(){var e,t=this;if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;var n=Object.entries(this.props.categories).map((function(e){var n=e[0],i=e[1],r={color:"rgba("+i.color.join(", ")+")"},o=i.enabled?"◼":"◻";return a.a.createElement("li",{key:n},a.a.createElement("a",{href:"#",onClick:function(){return t.props.toggleCategory(n)},onDoubleClick:function(){return t.props.showSingleCategory(n)}},a.a.createElement("span",{style:r},o)," ",t.formatCategoryLabel(n)))})),i="t"===this.props.position.charAt(0)?"top":"bottom",r="r"===this.props.position.charAt(1)?"right":"left",o=((e={position:"absolute"})[i]="0px",e[r]="10px",e);return a.a.createElement("div",{className:"legend",style:o},a.a.createElement("ul",{className:"categories"},n))},t}(a.a.PureComponent);u.propTypes=l,u.defaultProps={categories:{},toggleCategory:function(){},showSingleCategory:function(){},format:null,position:"tr"}},734:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(799),a=n.n(i),r=[1,0,1,0,0,0,0];function o(e,t){var n=parseInt(a()(t).format("x"),10);return parseInt(a()(t).add(e).format("x"),10)-n}function s(e,t){var n,i,s=a()(Math.min.apply(Math,e)),l=a()(Math.max.apply(Math,e));if(-1!==t.indexOf("/")){var u=t.split("/",2);u[0].endsWith("Z")?(i=a()(u[0]),n=a.a.duration(u[1])):(i=a()(u[1]),n=a.a.duration(u[0]))}else i=function(e,t){var n=a()(e).subtract(t),i=e.toArray(),o=n.toArray(),s=i.map((function(e,t){return o[t]!==e})).indexOf(!0),l=i.map((function(e,t){if(t===s){var n=e-o[t];return e-(e-r[t])%n}return t<s||-1===s?e:r[t]}));return a()(l)}(s,n=a.a.duration(t));var c,h=s.valueOf();for(c=i.clone();c.valueOf()<h;)c.add(n);for(;c.valueOf()>h;)c.subtract(n);var g,d=l.valueOf();for(g=i.clone();g.valueOf()>d;)g.subtract(n);for(;g.valueOf()<d;)g.add(n);var p=null==t?[c,g]:[c,c.clone().add(n)],f=e.every((function(e){return null===e}));return{start:parseInt(c.format("x"),10),end:parseInt(g.format("x"),10),getStep:o.bind(this,n),values:p.map((function(e){return parseInt(e.format("x"),10)})),disabled:f}}},736:function(e,t,n){"use strict";var i=n(0),a=n.n(i),r=n(1),o=n.n(r),s=n(727),l=n(792),u=n.n(l),c=n(690),h=n(793),g=n.n(h);n(798),n(752);function d(e){return a.a.createElement("span",{className:"BootstrapSliderWrapper"},a.a.createElement(g.a,e))}n(754);function p(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var f={start:o.a.number.isRequired,step:o.a.number.isRequired,end:o.a.number.isRequired,values:o.a.array.isRequired,onChange:o.a.func,loopDuration:o.a.number,maxFrames:o.a.number,orientation:o.a.oneOf(["horizontal","vertical"]),reversed:o.a.bool,disabled:o.a.bool,range:o.a.bool},v=function(e){function t(t){var n;(n=e.call(this,t)||this).state={intervalId:null};var i=t.end-t.start,a=Math.min(t.maxFrames,i/t.step),r=i/a;return n.intervalMilliseconds=t.loopDuration/a,n.increment=r<t.step?t.step:r-r%t.step,n.onChange=n.onChange.bind(p(n)),n.play=n.play.bind(p(n)),n.pause=n.pause.bind(p(n)),n.stepBackward=n.stepBackward.bind(p(n)),n.stepForward=n.stepForward.bind(p(n)),n.getPlayClass=n.getPlayClass.bind(p(n)),n.formatter=n.formatter.bind(p(n)),n}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var n=t.prototype;return n.componentDidMount=function(){u.a.bind(["space"],this.play)},n.componentWillUnmount=function(){u.a.unbind(["space"])},n.onChange=function(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()},n.getPlayClass=function(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"},n.play=function(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{var e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}},n.pause=function(){clearInterval(this.state.intervalId),this.setState({intervalId:null})},n.stepForward=function(){var e=this,t=this.props,n=t.start,i=t.end,a=t.step,r=t.values;if(!t.disabled){var o=(Array.isArray(r)?r:[r,r+a]).map((function(t){return t+e.increment})),s=o[1]>i?o[0]-n:0;this.props.onChange(o.map((function(e){return e-s})))}},n.stepBackward=function(){var e=this,t=this.props,n=t.start,i=t.end,a=t.step,r=t.values;if(!t.disabled){var o=(Array.isArray(r)?r:[r,r+a]).map((function(t){return t-e.increment})),s=o[0]<n?i-o[1]:0;this.props.onChange(o.map((function(e){return e+s})))}},n.formatter=function(e){if(this.props.disabled)return Object(c.b)("Data has no time steps");var t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map((function(e){return new Date(e).toUTCString()})).join(" : ")},n.render=function(){var e=this.props,t=e.start,n=e.end,i=e.step,r=e.orientation,o=e.reversed,s=e.disabled,l=e.range,u=e.values;return a.a.createElement("div",{className:"play-slider"},a.a.createElement("div",{className:"play-slider-controls padded"},a.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),a.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),a.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),a.a.createElement("div",{className:"play-slider-scrobbler padded"},a.a.createElement(d,{value:l?u:u[0],range:l,formatter:this.formatter,change:this.onChange,min:t,max:n,step:i,orientation:r,reversed:o,disabled:s?"disabled":"enabled"})))},t}(a.a.PureComponent);v.propTypes=f,v.defaultProps={onChange:function(){},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0},n.d(t,"a",(function(){return y}));var m={getLayers:o.a.func.isRequired,start:o.a.number.isRequired,end:o.a.number.isRequired,getStep:o.a.func,values:o.a.array.isRequired,aggregation:o.a.bool,disabled:o.a.bool,viewport:o.a.object.isRequired,children:o.a.node,mapStyle:o.a.string,mapboxApiAccessToken:o.a.string.isRequired,setControlValue:o.a.func,onValuesChange:o.a.func,width:o.a.number.isRequired,height:o.a.number.isRequired},y=function(e){function t(){return e.apply(this,arguments)||this}return function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e),t.prototype.render=function(){var e=this.props,t=e.start,n=e.end,i=e.getStep,r=e.disabled,o=e.aggregation,l=e.children,u=e.getLayers,c=e.values,h=e.onValuesChange,g=e.viewport,d=e.setControlValue,p=e.mapStyle,f=e.mapboxApiAccessToken,m=e.height,y=e.width,b=u(c);return a.a.createElement("div",null,a.a.createElement(s.a,{viewport:g,layers:b,setControlValue:d,mapStyle:p,mapboxApiAccessToken:f,bottomMargin:r?0:20,width:y,height:m}),!r&&a.a.createElement(v,{start:t,end:n,step:i(t),values:c,range:!o,onChange:h}),l)},t}(a.a.PureComponent);y.propTypes=m,y.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:function(){},onValuesChange:function(){}}},737:function(e,t,n){var i=n(738);"string"==typeof i&&(i=[[e.i,i,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(341)(i,a);i.locals&&(e.exports=i.locals)},738:function(e,t,n){(e.exports=n(340)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\ndiv.legend {\n    font-size: 90%;\n    position: absolute;\n    background: #fff;\n    box-shadow: 0 0 4px rgba(0, 0, 0, 0.15);\n    margin: 24px;\n    padding: 12px 20px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n}\n\nul.categories {\n    list-style: none;\n    padding-left: 0;\n    margin: 0;\n}\n\nul.categories li a {\n    color: rgb(51, 51, 51);\n    text-decoration: none;\n}\n\nul.categories li a span {\n    margin-right: 10px;\n}\n',""])},741:function(e,t,n){var i=n(742);"string"==typeof i&&(i=[[e.i,i,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(341)(i,a);i.locals&&(e.exports=i.locals)},742:function(e,t,n){(e.exports=n(340)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n .deckgl-tooltip > div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n',""])},752:function(e,t,n){var i=n(753);"string"==typeof i&&(i=[[e.i,i,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(341)(i,a);i.locals&&(e.exports=i.locals)},753:function(e,t,n){(e.exports=n(340)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n.BootstrapSliderWrapper .slider-selection {\n    background: #efefef;\n}\n\n.BootstrapSliderWrapper .slider-handle {\n    background: #b3b3b3;\n}\n\n',""])},754:function(e,t,n){var i=n(755);"string"==typeof i&&(i=[[e.i,i,""]]);var a={hmr:!0,transform:void 0,insertInto:void 0};n(341)(i,a);i.locals&&(e.exports=i.locals)},755:function(e,t,n){(e.exports=n(340)(!1)).push([e.i,'/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * "License"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n.play-slider {\n    display: flex;\n    height: 40px;\n    width: 100%;\n    margin: 0;\n}\n\n.play-slider-controls {\n    flex: 0 0 80px;\n    text-align: middle;\n}\n\n.play-slider-scrobbler {\n    flex: 1 1;\n}\n\n.slider.slider-horizontal {\n    width: 100% !important;\n}\n\n.slider-button {\n    color: #b3b3b3;\n    margin-right: 5px;\n}\n\ndiv.slider > div.tooltip.tooltip-main.top.in {\n    margin-left: 0 !important;\n}\n',""])},775:function(e,t){},781:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(714),a=n(716),r=n(709),o=n(710),s=function(e){return e.length},l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;Object(r.a)(this,e),this.sortedBins=this.getSortedBins(t,n),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}return Object(o.a)(e,[{key:"getSortedBins",value:function(e,t){return e.reduce((function(e,n,i){var a=t(n.points);return null!=a&&e.push({i:Number.isFinite(n.index)?n.index:i,value:a,counts:n.points.length}),e}),[]).sort((function(e,t){return e.value-t.value}))}},{key:"getValueRange",value:function(e){var t=Object(a.a)(e,2),n=t[0],i=t[1],r=this.sortedBins.length;if(!r)return[0,0];var o=Math.ceil(n/100*(r-1)),s=Math.floor(i/100*(r-1));return[this.sortedBins[o].value,this.sortedBins[s].value]}},{key:"getMaxCount",value:function(){var e=0;return this.sortedBins.forEach((function(t){return e=e>t.counts?e:t.counts})),e}},{key:"getBinMap",value:function(){return this.sortedBins.reduce((function(e,t){return Object.assign(e,Object(i.a)({},t.i,t))}),{})}}]),e}()},782:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return r}));var i=n(728);function a(e,t){return function(n){return function(e,t,n){var a=e[1]-e[0];if(a<=0)return i.a.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];var r=a/t.length,o=Math.floor((n-e[0])/r);return t[Math.max(Math.min(o,t.length-1),0)]}(e,t,n)}}function r(e,t){return function(n){return(n-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}}},820:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var i=n(709),a=n(710),r=n(711),o=n(211),s=n(720),l=n(712),u=n(784),c=n(728),h=n(764),g=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(a.a)(t,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(e){Object(s.a)(Object(o.a)(t.prototype),"setState",this).call(this,e),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(e){return e.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(e,t){var n=this.props._subLayerProps;return t&&t.length||n&&n[e]}},{key:"getSubLayerClass",value:function(e,t){var n=this.props._subLayerProps;return n&&n[e]&&n[e].type||t}},{key:"getSubLayerProps",value:function(e){var t=this.props,n=t.opacity,i=t.pickable,a=t.visible,r=t.parameters,o=t.getPolygonOffset,s=t.highlightedObjectIndex,l=t.autoHighlight,u=t.highlightColor,c=t.coordinateSystem,h=t.coordinateOrigin,g=t.wrapLongitude,d=t.positionFormat,p=t.modelMatrix,f=t._subLayerProps,v={opacity:n,pickable:i,visible:a,parameters:r,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:l,highlightColor:u,coordinateSystem:c,coordinateOrigin:h,wrapLongitude:g,positionFormat:d,modelMatrix:p};if(e){var m=f&&f[e.id],y=m&&m.updateTriggers;Object.assign(v,e,m,{id:"".concat(this.props.id,"-").concat(e.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},e.updateTriggers,y)})}return v}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var e=this.internalState.subLayers;e&&!this.needsUpdate()?c.a.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(e=this.renderLayers(),e=Object(h.b)(e,{filter:Boolean}),this.internalState.subLayers=e,c.a.log(2,"Composite layer rendered new subLayers ".concat(this),e)());var t=!0,n=!1,i=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){a.value.parent=this}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}},{key:"isComposite",get:function(){return!0}}]),t}(u.a);g.layerName="CompositeLayer"},822:function(e,t,n){"use strict";var i=n(709),a=n(710),r=n(711),o=n(211),s=n(720),l=n(712),u=n(808),c=n(784),h=n(1074),g=n(928),d=n(919),p=n(747),f=n(728),v=n(1063),m=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t);var n=e.id,a=void 0===n?Object(v.c)("column-geometry"):n,s=function(e){var t=e.radius,n=e.height,i=void 0===n?1:n,a=e.nradial,r=void 0===a?10:a,o=e.vertices;f.a.assert(!o||o.length>=r);for(var s=r+1,l=3*s,u=2*Math.PI/r,c=new Uint16Array(3*r*2),h=new Float32Array(3*l),g=new Float32Array(3*l),d=0,p=0;p<s;p++)for(var v=p*u,m=o&&o[p%r],y=o&&o[(p+1)%r],b=Math.sin(v),O=Math.cos(v),S=0;S<2;S++)h[d+0]=m?m[0]:O*t,h[d+1]=m?m[1]:b*t,h[d+2]=(.5-S)*i,g[d+0]=m?y[0]-m[0]:O,g[d+1]=m?y[1]-m[1]:b,d+=3;for(var C=0;C<s;C++){var w=Math.floor(C/2)*Math.sign(C%2-.5),x=w*u,k=o&&o[(w+r)%r],j=Math.sin(x),P=Math.cos(x);h[d+0]=k?k[0]:P*t,h[d+1]=k?k[1]:j*t,h[d+2]=i/2,g[d+2]=1,d+=3}for(var A=0,L=0;L<r;L++)c[A++]=2*L+0,c[A++]=2*L+2,c[A++]=2*L+0,c[A++]=2*L+1,c[A++]=2*L+1,c[A++]=2*L+3;return{indices:c,attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:g}}}}(e),l=s.indices,u=s.attributes;return Object(r.a)(this,Object(o.a)(t).call(this,Object(p.a)({},e,{id:a,indices:l,attributes:u})))}return Object(l.a)(t,e),t}(n(846).a);n.d(t,"a",(function(){return C}));var y=h.a.fp64LowPart,b=new g.a,O=[0,0,0,255],S={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,fp64:!1,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getFillColor:{type:"accessor",value:O},getLineColor:{type:"accessor",value:O},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:b,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},C=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(a.a)(t,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  \n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceFillColors:{size:4,type:5121,transition:!0,accessor:"getFillColor",defaultValue:O},instanceLineColors:{size:4,type:5121,transition:!0,accessor:"getLineColor",defaultValue:O},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,a=e.changeFlags;Object(s.a)(Object(o.a)(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:a});var r=n.fp64!==i.fp64;if(r){var l=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(l)}),this.getAttributeManager().invalidateAll()}(r||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices)&&this._updateGeometry(n)}},{key:"getGeometry",value:function(e,t){var n=new m({radius:1,height:2,vertices:t,nradial:e}),i=0;if(t)for(var a=0;a<e;a++){var r=t[a];i+=Math.sqrt(r[0]*r[0]+r[1]*r[1])/e}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*i}),n}},{key:"_getModel",value:function(e){return new d.a(e,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_updateGeometry",value:function(e){var t=e.diskResolution,n=e.vertices,i=this.getGeometry(t,n);this.setState({fillVertexCount:i.attributes.POSITION.value.length/3,wireframeVertexCount:i.indices.value.length}),this.state.model.setProps({geometry:i})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,a=i.lineWidthUnits,r=i.lineWidthScale,o=i.lineWidthMinPixels,s=i.lineWidthMaxPixels,l=i.elevationScale,u=i.extruded,c=i.filled,h=i.stroked,g=i.wireframe,d=i.offset,p=i.coverage,f=i.radius,v=i.angle,m=this.state,y=m.model,b=m.fillVertexCount,O=m.wireframeVertexCount,S=m.edgeDistance,C="pixels"===a?n.distanceScales.metersPerPixel[2]:1;y.setUniforms(Object.assign({},t,{radius:f,angle:v/180*Math.PI,offset:d,extruded:u,coverage:p,elevationScale:l,edgeDistance:S,widthScale:r*C,widthMinPixels:o,widthMaxPixels:s})),u&&g&&(y.setProps({isIndexed:!0}),y.setVertexCount(O).setDrawMode(1).setUniforms({isStroke:!0}).draw()),c&&(y.setProps({isIndexed:!1}),y.setVertexCount(b).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!u&&h&&(y.setProps({isIndexed:!1}),y.setVertexCount(2*b/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}},{key:"calculateInstancePositions64xyLow",value:function(e,t){var n=t.startRow,i=t.endRow,a=this.use64bitPositions();if(e.constant=!a,a){var r=this.props,o=r.data,s=r.getPosition,l=e.value,c=n*e.size,h=Object(u.a)(o,n,i),g=h.iterable,d=h.objectInfo,p=!0,f=!1,v=void 0;try{for(var m,b=g[Symbol.iterator]();!(p=(m=b.next()).done);p=!0){var O=m.value;d.index++;var S=s(O,d);l[c++]=y(S[0]),l[c++]=y(S[1])}}catch(e){f=!0,v=e}finally{try{p||null==b.return||b.return()}finally{if(f)throw v}}}else e.value=new Float32Array(2)}}]),t}(c.a);C.layerName="ColumnLayer",C.defaultProps=S},918:function(e,t,n){"use strict";n.r(t);var i=n(709),a=n(710),r=n(711),o=n(211),s=n(712),l=n(820),u=n(769),c=n(720),h=n(928),g=n(728),d=n(735),p=n(716),f=n(779),v=n(844),m=n(791),y=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"toString",value:function(){var e="[";if(m.a.printRowMajor){e+="row-major:";for(var t=0;t<this.RANK;++t)for(var n=0;n<this.RANK;++n)e+=" ".concat(this[n*this.RANK+t])}else{e+="column-major:";for(var i=0;i<this.ELEMENTS;++i)e+=" ".concat(this[i])}return e+="]"}},{key:"getElementIndex",value:function(e,t){return t*this.RANK+e}},{key:"getElement",value:function(e,t){return this[t*this.RANK+e]}},{key:"setElement",value:function(e,t,n){return this[t*this.RANK+e]=Object(f.a)(n),this}},{key:"getColumn",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),n=e*this.RANK,i=0;i<this.RANK;++i)t[i]=this[n+i];return t}},{key:"setColumn",value:function(e,t){for(var n=e*this.RANK,i=0;i<this.RANK;++i)this[n+i]=t[i];return this}}]),t}(v.a),b=n(843),O=n(762),S=n(757),C=n(756),w=n(761),x=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),k=Object.freeze([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),j=Object.freeze({COL0ROW0:0,COL0ROW1:1,COL0ROW2:2,COL0ROW3:3,COL1ROW0:4,COL1ROW1:5,COL1ROW2:6,COL1ROW3:7,COL2ROW0:8,COL2ROW1:9,COL2ROW2:10,COL2ROW3:11,COL3ROW0:12,COL3ROW1:13,COL3ROW2:14,COL3ROW3:15}),P={},A=function(e){function t(e){var n;return Object(i.a)(this,t),n=Object(r.a)(this,Object(o.a)(t).call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0)),1===arguments.length&&Array.isArray(e)?n.copy(e):n.identity(),n}return Object(s.a)(t,e),Object(a.a)(t,[{key:"INDICES",get:function(){return j}},{key:"ELEMENTS",get:function(){return 16}},{key:"RANK",get:function(){return 4}}],[{key:"IDENTITY",get:function(){return P.IDENTITY=P.IDENTITY||Object.freeze(new t(x)),P.IDENTITY}},{key:"ZERO",get:function(){return P.ZERO=P.ZERO||Object.freeze(new t(k)),P.ZERO}}]),Object(a.a)(t,[{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}},{key:"set",value:function(e,t,n,i,a,r,o,s,l,u,c,h,g,d,p,f){return this[0]=e,this[1]=t,this[2]=n,this[3]=i,this[4]=a,this[5]=r,this[6]=o,this[7]=s,this[8]=l,this[9]=u,this[10]=c,this[11]=h,this[12]=g,this[13]=d,this[14]=p,this[15]=f,this.check()}},{key:"setRowMajor",value:function(e,t,n,i,a,r,o,s,l,u,c,h,g,d,p,f){return this[0]=e,this[1]=a,this[2]=l,this[3]=g,this[4]=t,this[5]=r,this[6]=u,this[7]=d,this[8]=n,this[9]=o,this[10]=c,this[11]=p,this[12]=i,this[13]=s,this[14]=h,this[15]=f,this.check()}},{key:"toRowMajor",value:function(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}},{key:"identity",value:function(){return this.copy(x)}},{key:"fromQuaternion",value:function(e){return O.c(this,e),this.check()}},{key:"frustum",value:function(e){var n=e.left,i=e.right,a=e.bottom,r=e.top,o=e.near,s=e.far;return s===1/0?t._computeInfinitePerspectiveOffCenter(this,n,i,a,r,o):O.d(this,n,i,a,r,o,s),this.check()}},{key:"lookAt",value:function(e,t,n){if(1===arguments.length){var i=e;e=i.eye,t=i.center,n=i.up}return t=t||[0,0,0],n=n||[0,1,0],O.f(this,e,t,n),this.check()}},{key:"ortho",value:function(e){var t=e.left,n=e.right,i=e.bottom,a=e.top,r=e.near,o=void 0===r?.1:r,s=e.far,l=void 0===s?500:s;return O.h(this,t,n,i,a,o,l),this.check()}},{key:"orthographic",value:function(e){var n=e.fovy,i=void 0===n?45*Math.PI/180:n,a=e.aspect,r=void 0===a?1:a,o=e.focalDistance,s=void 0===o?1:o,l=e.near,u=void 0===l?.1:l,c=e.far,h=void 0===c?500:c;if(i>2*Math.PI)throw Error("radians");var g=i/2,d=s*Math.tan(g),p=d*r;return(new t).ortho({left:-p,right:p,bottom:-d,top:d,near:u,far:h})}},{key:"perspective",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.fovy,n=e.fov,i=void 0===n?45*Math.PI/180:n,a=e.aspect,r=void 0===a?1:a,o=e.near,s=void 0===o?.1:o,l=e.far,u=void 0===l?500:l;if((t=t||i)>2*Math.PI)throw Error("radians");return O.i(this,t,r,s,u),this.check()}},{key:"determinant",value:function(){return O.a(this)}},{key:"getScale",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}},{key:"getTranslation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0];return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}},{key:"getRotation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(t||[-0,-0,-0]),i=1/n[0],a=1/n[1],r=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*a,e[2]=this[2]*r,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*a,e[6]=this[6]*r,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*a,e[10]=this[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}},{key:"getRotationMatrix3",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.getScale(t||[-0,-0,-0]),i=1/n[0],a=1/n[1],r=1/n[2];return e[0]=this[0]*i,e[1]=this[1]*a,e[2]=this[2]*r,e[3]=this[4]*i,e[4]=this[5]*a,e[5]=this[6]*r,e[6]=this[8]*i,e[7]=this[9]*a,e[8]=this[10]*r,e}},{key:"transpose",value:function(){return O.p(this,this),this.check()}},{key:"invert",value:function(){return O.e(this,this),this.check()}},{key:"multiplyLeft",value:function(e){return O.g(this,e,this),this.check()}},{key:"multiplyRight",value:function(e){return O.g(this,this,e),this.check()}},{key:"rotateX",value:function(e){return O.k(this,this,e),this.check()}},{key:"rotateY",value:function(e){return O.l(this,this,e),this.check()}},{key:"rotateZ",value:function(e){return O.m(this,this,e),this.check()}},{key:"rotateXYZ",value:function(e){var t=Object(p.a)(e,3),n=t[0],i=t[1],a=t[2];return this.rotateX(n).rotateY(i).rotateZ(a)}},{key:"rotateAxis",value:function(e,t){return O.j(this,this,e,t),this.check()}},{key:"scale",value:function(e){return Array.isArray(e)?O.n(this,this,e):O.n(this,this,[e,e,e]),this.check()}},{key:"translate",value:function(e){return O.o(this,this,e),this.check()}},{key:"transform",value:function(e,t){return 4===e.length?(t=w.c(t||[-0,-0,-0,-0],e,this),Object(f.b)(t,4),t):this.transformAsPoint(e,t)}},{key:"transformAsPoint",value:function(e,t){switch(e.length){case 2:t=S.h(t||[-0,-0],e,this);break;case 3:t=C.j(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Object(f.b)(t,e.length),t}},{key:"transformAsVector",value:function(e,t){switch(e.length){case 2:t=Object(b.a)(t||[-0,-0],e,this);break;case 3:t=Object(b.c)(t||[-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Object(f.b)(t,e.length),t}},{key:"makeRotationX",value:function(e){return this.identity().rotateX(e)}},{key:"makeTranslation",value:function(e,t,n){return this.identity().translate([e,t,n])}},{key:"transformPoint",value:function(e,t){return Object(f.c)("Matrix4.transformPoint","3.0"),this.transformAsPoint(e,t)}},{key:"transformVector",value:function(e,t){return Object(f.c)("Matrix4.transformVector","3.0"),this.transformAsPoint(e,t)}},{key:"transformDirection",value:function(e,t){return Object(f.c)("Matrix4.transformDirection","3.0"),this.transformAsVector(e,t)}}],[{key:"_computeInfinitePerspectiveOffCenter",value:function(e,t,n,i,a,r){var o=2*r/(n-t),s=2*r/(a-i),l=(n+t)/(n-t),u=(a+i)/(a-i),c=-2*r;return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=l,e[9]=u,e[10]=-1,e[11]=-1,e[12]=0,e[13]=0,e[14]=c,e[15]=0,e}}]),t}(y),L=n(1074),_=n(715),E=n(777),M=n(808),D=_.a.count,R=L.a.fp64LowPart,I=6378e3;function N(e){return Number.isFinite(e)?e:0}function F(e){var t=e.data,n=e.getPosition,i=e.cellSizeMeters,a=e.gpuGridAggregator,r=e.gpuAggregation,o=e.aggregationFlags,s=e.weightParams,l=e.fp64,u=void 0!==l&&l,c=e.coordinateSystem,h=void 0===c?E.a.LNGLAT:c,d=e.viewport,p=void 0===d?null:d,f=e.boundingBox,v=void 0===f?null:f,m={};o.dataChanged&&(v=(m=function(e,t,n){var i,a,r=D(e),o=new Float64Array(2*r),s=new Float32Array(2*r),l=1/0,u=-1/0,c=1/0,h=-1/0,g={};for(var d in n)g[d]=Object.assign({},n[d],{values:new Float32Array(3*r)});var p=Object(M.a)(e),f=p.iterable,v=p.objectInfo,m=!0,y=!1,b=void 0;try{for(var O,S=f[Symbol.iterator]();!(m=(O=S.next()).done);m=!0){var C=O.value;v.index++;var w=t(C,v),x=v.index;for(var k in a=w[0],i=w[1],o[2*x]=a,o[2*x+1]=i,s[2*x]=R(a),s[2*x+1]=R(i),n){var j=n[k].getWeight(C);Array.isArray(j)?(g[k].values[3*x]=j[0],g[k].values[3*x+1]=j[1],g[k].values[3*x+2]=j[2]):g[k].values[3*x]=j}Number.isFinite(i)&&Number.isFinite(a)&&(l=i<l?i:l,u=i>u?i:u,c=a<c?a:c,h=a>h?a:h)}}catch(e){y=!0,b=e}finally{try{m||null==S.return||S.return()}finally{if(y)throw b}}var P={xMin:N(c),xMax:N(h),yMin:N(l),yMax:N(u)};return{positions:o,positions64xyLow:s,weights:g,boundingBox:P}}(t,n,s)).boundingBox);var y=[i,i],b=[0,0];switch(g.a.assert(h===E.a.LNGLAT||h===E.a.IDENTITY),h){case E.a.LNGLAT:case E.a.LNGLAT_DEPRECATED:var O=function(e,t){var n=e.yMin,i=e.yMax;return function(e,t){var n=(o=e,o/I*(180/Math.PI)),i=(a=t,r=e,r/I*(180/Math.PI)/Math.cos(a*Math.PI/180));var a,r;var o;return{yOffset:n,xOffset:i}}(t,(n+i)/2)}(v,i);y=[O.xOffset,O.yOffset],b=[-180,-90];break;case E.a.IDENTITY:b=[-p.width/2,-p.height/2];break;default:g.a.assert(!1)}var S=function(e){var t=e.boundingBox,n=e.cellSize,i=e.worldOrigin,a=t.yMin,r=t.yMax,o=t.xMin,s=t.xMax,l=T(o-i[0],n[0])+i[0],u=T(a-i[1],n[1])+i[1],c=(new A).translate([-1*l,-1*u,0]),h=[l,u],g=s-o+n[0],d=r-a+n[1],p=[Math.ceil(g/n[0]),Math.ceil(d/n[1])];return{gridOrigin:h,gridSize:p,width:g,height:d,gridTransformMatrix:c}}({boundingBox:v,cellSize:y,worldOrigin:b});return{weights:a.run({positions:m.positions,positions64xyLow:m.positions64xyLow,weights:m.weights,cellSize:y,width:S.width,height:S.height,gridTransformMatrix:S.gridTransformMatrix,useGPU:r,changeFlags:o,fp64:u}),gridSize:S.gridSize,gridOrigin:S.gridOrigin,cellSize:y,boundingBox:v}}function T(e,t){var n=e<0?-1:1,i=n<0?Math.abs(e)+t:Math.abs(e);return(i=Math.floor(i/t)*t)*n}var V=n(740),z=n(784),U=n(919),W=n(747),B=n(846),G=n(1063),q=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),H=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),K=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),Y=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),X={POSITION:{size:3,value:new Float32Array(H)},NORMAL:{size:3,value:new Float32Array(K)},TEXCOORD_0:{size:2,value:new Float32Array(Y)}},Z=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t);var n=e.id,a=void 0===n?Object(G.c)("cube-geometry"):n;return Object(r.a)(this,Object(o.a)(t).call(this,Object(W.a)({},e,{id:a,indices:{size:1,value:new Uint16Array(q)},attributes:Object(W.a)({},X,e.attributes)})))}return Object(s.a)(t,e),t}(B.a),J=L.a.fp64LowPart,Q=new h.a,$={colorDomain:null,colorRange:V.b,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",min:0,value:[1,1]},gridOrigin:{type:"array",min:0,value:[0,0]},gridOffset:{type:"array",min:0,value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",min:0,value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,fp64:!1,material:Q},ee=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getShaders",value:function(){return{vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 normals;\n\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\n\nlayout(std140) uniform;\nuniform ColorData\n{\n  vec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\n  vec4 maxMinCount;\n} elevationData;\n\n#define EPSILON 0.00001\nout vec4 vColor;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  return outColor;\n}\n\nfloat linearScale(vec2 domain, vec2 range, float value) {\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n  }\n  return -1.;\n}\n\nvoid main(void) {\n\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\n\n  float elevation = 0.0;\n\n  if (extruded) {\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\n\n  int yIndex = (gl_InstanceID / gridSize[0]);\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\n\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\n  vec2 centroidPosition64xyLow = vec2(instancePositionXFP64[1], instancePositionYFP64[1]);\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\n  picking_setPickingColor(instancePickingColors);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(normals);\n\n   if (extruded) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\n  }\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vColor;\n  fragColor = picking_filterColor(fragColor);\n}\n",modules:["project32","gouraud-lighting","picking","fp64"]}}},{key:"initializeState",value:function(){var e=this.context.gl;this.getAttributeManager().addInstanced({colors:{size:4,update:this.calculateColors,noAlloc:!0},elevations:{size:4,update:this.calculateElevations,noAlloc:!0}});var t=this._getModel(e);this._setupUniformBuffer(t),this.setState({model:t})}},{key:"_getModel",value:function(e){return new U.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new Z,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.data,a=n.cellSize,r=n.offset,o=n.extruded,s=n.elevationScale,l=n.coverage,u=n.gridSize,c=n.gridOrigin,h=n.gridOffset,g=n.colorRange,d=n.elevationRange,p=[J(c[0]),J(c[1])],f=[J(h[0]),J(h[1])],v=i.color.maxMinBuffer,m=i.elevation.maxMinBuffer;v.bind({target:35345,index:0}),m.bind({target:35345,index:1});var y=this.getDomainUniforms();this.state.model.setUniforms(Object.assign({},t,y,{cellSize:a,offset:r,extruded:o,elevationScale:s,coverage:l,gridSize:u,gridOrigin:c,gridOriginLow:p,gridOffset:h,gridOffsetLow:f,colorRange:g,elevationRange:d})).draw(),v.unbind({target:35345,index:0}),m.unbind({target:35345,index:1})}},{key:"calculateColors",value:function(e){var t=this.props.data;e.update({buffer:t.color.aggregationBuffer})}},{key:"calculateElevations",value:function(e){var t=this.props.data;e.update({buffer:t.elevation.aggregationBuffer})}},{key:"getDomainUniforms",value:function(){var e=this.props,t=e.colorDomain,n=e.elevationDomain,i={};return null!==t?(i.colorDomainValid=!0,i.colorDomain=t):i.colorDomainValid=!1,null!==n?(i.elevationDomainValid=!0,i.elevationDomain=n):i.elevationDomainValid=!1,i}},{key:"_setupUniformBuffer",value:function(e){var t=this.context.gl,n=e.program.handle,i=t.getUniformBlockIndex(n,"ColorData"),a=t.getUniformBlockIndex(n,"ElevationData");t.uniformBlockBinding(n,i,0),t.uniformBlockBinding(n,a,1)}}]),t}(z.a);ee.layerName="GPUGridCellLayer",ee.defaultProps=$;var te=6378e3;function ne(e,t,n){var i=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,a=1/0,r=-1/0,o=Object(M.a)(t),s=o.iterable,l=o.objectInfo,u=!0,c=!1,h=void 0;try{for(var g,d=s[Symbol.iterator]();!(u=(g=d.next()).done);u=!0){var f=g.value;l.index++,e=i(f,l)[1],Number.isFinite(e)&&(a=e<a?e:a,r=e>r?e:r)}}catch(e){c=!0,h=e}finally{try{u||null==d.return||d.return()}finally{if(c)throw h}}var v=function(e,t){var n=(o=e,o/te*(180/Math.PI)),i=(a=t,r=e,r/te*(180/Math.PI)/Math.cos(a*Math.PI/180));var a,r;var o;return{yOffset:n,xOffset:i}}(n,(a+r)/2);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var m={};l.index=-1;var y=!0,b=!1,O=void 0;try{for(var S,C=s[Symbol.iterator]();!(y=(S=C.next()).done);y=!0){var w=S.value;l.index++;var x=i(w,l),k=Object(p.a)(x,2),j=k[0],P=k[1];if(Number.isFinite(P)&&Number.isFinite(j)){var A=Math.floor((P+90)/v.yOffset),L=Math.floor((j+180)/v.xOffset),_="".concat(A,"-").concat(L);m[_]=m[_]||{count:0,points:[]},m[_].count+=1,m[_].points.push(w)}}}catch(e){b=!0,O=e}finally{try{y||null==C.return||C.return()}finally{if(b)throw O}}return{gridHash:m,gridOffset:v}}(e,t,n),a=i.gridHash,r=i.gridOffset;return{gridHash:a,gridOffset:r,layerData:function(e,t){return Object.keys(e).reduce((function(n,i,a){var r=i.split("-"),o=parseInt(r[0],10),s=parseInt(r[1],10);return n.push(Object.assign({index:a,position:[t.xOffset*s-180,t.yOffset*o-90]},e[i])),n}),[])}(a,r)}}var ie=new h.a,ae={colorDomain:null,colorRange:V.b,getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(e){return e.position}},extruded:!1,fp64:!1,material:ie,gpuAggregation:!0},re=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"initializeState",value:function(){var e=this.context.gl,t=u.a.isSupported(e);t||g.a.error("GPUGridLayer is not supported on this browser, use GridLayer instead")();var n={id:"".concat(this.id,"-gpu-aggregator"),shaderCache:this.context.shaderCache};this.state={gpuGridAggregator:new u.a(e,n),isSupported:t}}},{key:"updateState",value:function(e){var t=this.getAggregationFlags(e);t&&(this.getLayerData(t),this.setState({gridHash:null}))}},{key:"finalizeState",value:function(){Object(c.a)(Object(o.a)(t.prototype),"finalizeState",this).call(this),this.state.gpuGridAggregator.delete()}},{key:"getAggregationFlags",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags,a=null;return!!this.state.isSupported&&(this.isDataChanged({oldProps:t,props:n,changeFlags:i})&&(a=Object.assign({},a,{dataChanged:!0})),t.cellSize!==n.cellSize&&(a=Object.assign({},a,{cellSizeChanged:!0})),a)}},{key:"isDataChanged",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags;return!!i.dataChanged||(t.gpuAggregation!==n.gpuAggregation||(t.colorAggregation!==n.colorAggregation||t.elevationAggregation!==n.elevationAggregation||!(!i.updateTriggersChanged||!(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition||i.updateTriggersChanged.getColorWeight||i.updateTriggersChanged.getElevationWeight))))}},{key:"getHashKeyForIndex",value:function(e){var t=this.state,n=t.gridSize,i=t.gridOrigin,a=t.cellSize,r=Math.floor(e/n[0]),o=e-r*n[0],s=Math.floor((r*a[1]+i[1]+90+a[1]/2)/a[1]),l=Math.floor((o*a[0]+i[0]+180+a[0]/2)/a[0]);return"".concat(s,"-").concat(l)}},{key:"getPositionForIndex",value:function(e){var t=this.state,n=t.gridSize,i=t.gridOrigin,a=t.cellSize,r=Math.floor(e/n[0]),o=e-r*n[0],s=r*a[1]+i[1];return[o*a[0]+i[0],s]}},{key:"getPickingInfo",value:function(e){var t=e.info,n=e.mode,i=t.index,a=null;if(i>=0){var r=this.state.gpuGridAggregator,o=this.getPositionForIndex(i),s=u.a.getAggregationData(Object.assign({pixelIndex:i},r.getData("color"))),l=u.a.getAggregationData(Object.assign({pixelIndex:i},r.getData("elevation")));if(a={colorValue:s.cellWeight,elevationValue:l.cellWeight,count:s.cellCount||l.cellCount,position:o,totalCount:s.totalCount||l.totalCount},"hover"!==n){var c=this.props,h=c.data,g=c.getPosition,d=this.state.gridHash;if(!d)d=ne(h,this.props.cellSize,g).gridHash,this.setState({gridHash:d});var p=d[this.getHashKeyForIndex(i)];Object.assign(a,p)}}return Object.assign(t,{picked:Boolean(a),object:a})}},{key:"getLayerData",value:function(e){var t=this.props,n=t.data,i=t.cellSize,a=t.getPosition,r=t.gpuAggregation,o=t.getColorWeight,s=t.colorAggregation,l=t.getElevationWeight,u=t.elevationAggregation,c=t.fp64,h=F({data:n,cellSizeMeters:i,getPosition:a,weightParams:{color:{getWeight:o,operation:d.a[s]||d.a[ae.colorAggregation],needMin:!0,needMax:!0,combineMaxMin:!0},elevation:{getWeight:l,operation:d.a[u]||d.a[ae.elevationAggregation],needMin:!0,needMax:!0,combineMaxMin:!0}},gpuAggregation:r,gpuGridAggregator:this.state.gpuGridAggregator,boundingBox:this.state.boundingBox,aggregationFlags:e,fp64:c}),g=h.weights,p=h.gridSize,f=h.gridOrigin,v=h.cellSize,m=h.boundingBox;this.setState({weights:g,gridSize:p,gridOrigin:f,cellSize:v,boundingBox:m})}},{key:"renderLayers",value:function(){if(!this.state.isSupported)return null;var e=this.props,t=e.elevationScale,n=e.fp64,i=e.extruded,a=e.cellSize,r=e.coverage,o=e.material,s=e.elevationRange,l=e.colorDomain,u=e.elevationDomain,c=this.state,h=c.weights,g=c.gridSize,d=c.gridOrigin,p=c.cellSize,f=Object(V.a)(this.props.colorRange,Float32Array,255);return new(this.getSubLayerClass("gpu-grid-cell",ee))({gridSize:g,gridOrigin:d,gridOffset:p,colorRange:f,elevationRange:s,colorDomain:l,elevationDomain:u,fp64:n,cellSize:a,coverage:r,material:o,elevationScale:t,extruded:i},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:h,numInstances:g[0]*g[1]})}}]),t}(l.a);re.layerName="GPUGridLayer",re.defaultProps=ae;var oe=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"getGeometry",value:function(e){return new Z}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.elevationScale,a=n.extruded,r=n.offset,o=n.coverage,s=n.cellSize,l=n.angle;this.state.model.setUniforms(Object.assign({},t,{radius:s/2,angle:l,offset:r,extruded:a,coverage:o,elevationScale:i,edgeDistance:1,isWireframe:!1})).draw()}}]),t}(n(822).a);oe.layerName="GridCellLayer",oe.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};var se=n(781),le=n(782);function ue(){}var ce=new h.a,he={colorDomain:null,colorRange:V.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},onSetColorDomain:ue,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:1,onSetElevationDomain:ue,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(e){return e.position}},extruded:!1,fp64:!1,material:ce},ge=["getColorValue","colorAggregation","getColorWeight"],de=["getElevationValue","elevationAggregation","getElevationWeight"],pe=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"initializeState",value:function(){this.state={layerData:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:ue,elevationScaleFunc:ue,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(e){var t=this,n=e.oldProps,i=e.props,a=e.changeFlags;this.updateGetValueFuncs(n,i);var r=this.needsReProjectPoints(n,i,a);a.dataChanged||r?this.getLayerData():(this.getDimensionChanges(n,i)||[]).forEach((function(e){return"function"==typeof e&&e.apply(t)}))}},{key:"colorElevationPropsChanged",value:function(e,t){for(var n=!1,i=!1,a=0;a<ge.length;a++){var r=ge[a];e[r]!==t[r]&&(n=!0)}for(var o=0;o<de.length;o++){var s=de[o];e[s]!==t[s]&&(i=!0)}return{colorChanged:n,elevationChanged:i}}},{key:"updateGetValueFuncs",value:function(e,t){var n=t.getColorValue,i=t.getElevationValue,a=this.props,r=a.colorAggregation,o=a.getColorWeight,s=a.elevationAggregation,l=a.getElevationWeight,u=this.colorElevationPropsChanged(e,t),c=u.colorChanged,h=u.elevationChanged;c&&null===n&&(n=Object(d.b)(r,o)),h&&null===i&&(i=Object(d.b)(s,l)),n&&this.setState({getColorValue:n}),i&&this.setState({getElevationValue:i})}},{key:"needsReProjectPoints",value:function(e,t,n){return e.cellSize!==t.cellSize||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(e,t){var n=this.state.dimensionUpdaters,i=[];for(var a in n){var r=n[a].find((function(n){return n.triggers.some((function(n){return e[n]!==t[n]}))}));r&&i.push(r.updater)}return i.length?i:null}},{key:"getPickingInfo",value:function(e){var t=e.info,n=this.state,i=n.sortedColorBins,a=n.sortedElevationBins,r=null;if(t.picked&&t.index>-1){var o=this.state.layerData[t.index],s=i.binMap[o.index]&&i.binMap[o.index].value,l=a.binMap[o.index]&&a.binMap[o.index].value;r=Object.assign({colorValue:s,elevationValue:l},o)}return Object.assign(t,{picked:Boolean(r),object:r})}},{key:"getUpdateTriggers",value:function(){var e=this,t=this.state.dimensionUpdaters,n={},i=function(i){n[i]={};var a=!0,r=!1,o=void 0;try{for(var s,l=t[i][Symbol.iterator]();!(a=(s=l.next()).done);a=!0){s.value.triggers.forEach((function(t){n[i][t]=e.props[t]}))}}catch(e){r=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}};for(var a in t)i(a);return n}},{key:"getLayerData",value:function(){var e=this.props,t=ne(e.data,e.cellSize,e.getPosition).layerData;this.setState({layerData:t}),this.getSortedBins()}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var e=this.state.getColorValue,t=new se.a(this.state.layerData||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var e=this.state.getElevationValue,t=new se.a(this.state.layerData||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var e=this.props,t=e.lowerPercentile,n=e.upperPercentile,i=e.onSetColorDomain;this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var e=this.props,t=e.elevationLowerPercentile,n=e.elevationUpperPercentile,i=e.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var e=this.props.colorRange,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Object(le.b)(t,e)}},{key:"getElevationScale",value:function(){var e=this.props.elevationRange,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Object(le.a)(t,e)}},{key:"_onGetSublayerColor",value:function(e){var t=this.state,n=t.sortedColorBins,i=t.colorScaleFunc,a=t.colorValueDomain,r=n.binMap[e.index]&&n.binMap[e.index].value,o=this.props.colorDomain||a,s=r>=o[0]&&r<=o[o.length-1]?i(r):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(e){var t=this.state,n=t.sortedElevationBins,i=t.elevationScaleFunc,a=t.elevationValueDomain,r=n.binMap[e.index]&&n.binMap[e.index].value,o=this.props.elevationDomain||a;return r>=o[0]&&r<=o[o.length-1]?i(r):-1}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,n=e.fp64,i=e.extruded,a=e.cellSize,r=e.coverage,o=e.material,s=e.transitions;return new(this.getSubLayerClass("grid-cell",oe))({fp64:n,cellSize:a,coverage:r,material:o,elevationScale:t,extruded:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.layerData})}}]),t}(l.a);pe.layerName="CPUGridLayer",pe.defaultProps=he;var fe=Object.assign({},re.defaultProps,pe.defaultProps,{gpuAggregation:!1}),ve=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"initializeState",value:function(){this.state={useGPUAggregation:!0}}},{key:"updateState",value:function(e){e.oldProps;var t=e.props,n=(e.changeFlags,{});n.useGPUAggregation=this.canUseGPUAggregation(t),this.setState(n)}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e.updateTriggers,i=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",re):this.getSubLayerClass("CPU",pe))(this.props,this.getSubLayerProps({id:i,updateTriggers:n}),{data:t})}},{key:"canUseGPUAggregation",value:function(e){var t=e.gpuAggregation,n=e.lowerPercentile,i=e.upperPercentile,a=e.getColorValue,r=e.getElevationValue;return!!t&&(!!u.a.isSupported(this.context.gl)&&(0===n&&100===i&&(null===a&&null===r)))}}]),t}(l.a);ve.layerName="GridLayer",ve.defaultProps=fe;var me=n(0),ye=n.n(me),be=n(690),Oe=n(718),Se=n(719),Ce=n(732),we=n(724);function xe(){return(xe=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}function ke(e){return ye.a.createElement("div",{className:"deckgl-tooltip"},ye.a.createElement(we.a,{label:Object(be.b)("Longitude and Latitude")+": ",value:e.coordinate[0]+", "+e.coordinate[1]}),ye.a.createElement(we.a,{label:Object(be.b)("Height")+": ",value:""+e.object.elevationValue}))}function je(e,t,n,i){var a=e,r=a.color_picker,o=t.data.features.map((function(e){return xe({},e,{color:[r.r,r.g,r.b,255*r.a]})}));a.js_data_mutator&&(o=Object(Se.a)(a.js_data_mutator)(o));var s=Object(Oe.c)(a.js_agg_function,(function(e){return e.weight}));return new ve(xe({id:"grid-layer-"+a.slice_id,data:o,pickable:!0,cellSize:a.grid_size,minColor:[0,0,0,0],extruded:a.extruded,maxColor:[r.r,r.g,r.b,255*r.a],outline:!1,getElevationValue:s,getColorValue:s},Object(Oe.a)(a,i,ke)))}n.d(t,"getLayer",(function(){return je}));t.default=Object(Ce.b)(je,(function(e){return e.map((function(e){return e.position}))}))},928:function(e,t,n){"use strict";var i=n(709),a=n(711),r=n(211),o=n(212),s=n(712);n.d(t,"a",(function(){return u}));var l={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},u=function(e){function t(e){var n;return Object(i.a)(this,t),n=Object(a.a)(this,Object(r.a)(t).call(this,e)),e=Object.assign({},l,e),Object.assign(Object(o.a)(n),e),n}return Object(s.a)(t,e),t}((function e(){Object(i.a)(this,e)}))}}]);